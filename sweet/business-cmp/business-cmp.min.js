/*! sweet 2015-04-02 
 *  SweetUI JS Library 2.0 
 *  Copyright © Huawei Technologies Co., Ltd. 2013. All rights reserved. 
 *  http://www.huawei.com 
*/(function(){BusinessI18NZH.cmp={timeRange:{timeRange:"时间范围",interval:"粒度",interval_86400:"天",interval_3600:"1 小时",interval_900:"15 分钟",timeStoreMsg:"系统可以提供{0}起始的数据查询。",finalTimeMsg:"终止时间输入有误。",size:{timeLableWidth:75,intervalLableWidth:50,intervalWidth:144}},area:{labelText:"区域",listWindowLeftTitle:"选择项",listWindowRightTitle:"已选择",cell:"CGI/SAI",officDirection:"局向",pleaseSelect:"请选择…",selectCell:"选择小区",selectTopN:"选择Top N",allText:"全选",pleaseSelectArea:"请选择区域！",notEmpty:"不能为空。",onlyChartNum:"只能为数字或0-9,a-z,A-Z的组合.",source:"源:",destination:"目的:",size:{lableWidth:75}},more:{windowTitle:"更多",indicator:"指标",add:"添加","delete":"删除",selectKpi:"请选择指标！"},queryCondition:{query:"查询"},gridDrill:{cdrDrill:"CDR详单记录",failercauseDrill:"失败原因分析",hocauseDrill:"切换原因分析"},line:{chartDisplay:"图表展示",selectObject:"选择对象",indexLabelText:"指标",selectPeriod:"选择周期",multiObject:"多对象对比",history:"历史趋势",timeDate:[[1,"一天前"],[2,"两天前"],[3,"三天前"],[4,"四天前"],[5,"五天前"],[6,"六天前"],[7,"七天前"]],currentPeriod:"本周期",size:{objBoxWidth:324,objBoxLabelWidth:74,indexWidth:300,indexLabelWidth:50,periodWidth:324,periodLabelWidth:74,radioWidth:200}},grid:{gridDisplay:"报表详情",counterTool:"次数",sn:"序号"},conditionManage:{queryConditionHistory:"选择查询条件",queryConditionSave:"保存查询条件",queryConditionLast:"最后一次查询",inputTemplateName:"请输入模板名称：",save:"保存",ok:"确认","delete":"删除",noInput:"只能输入字母、数字、汉字、下划线或中划线！",saveTempletError:"保存模板失败！",deleteTempletTips:'您确定要删除模板"{0}"吗？'},failCause:{baseTitle:"失败原因分析",tabelName:"信令详单",leftPieTitle:"失败原因归属占比",rightPieTitle:"失败原因占比"}},BusinessI18NEN.cmp={timeRange:{timeRange:"Time Period",interval:"Interval",interval_86400:"Day",interval_3600:"1 Hour",interval_900:"15 Minutes",timeStoreMsg:"The earliest start date for this data query is {0}.",finalTimeMsg:"The end time input error.",size:{timeLableWidth:90,intervalLableWidth:66,intervalWidth:165}},area:{labelText:"Area",listWindowLeftTitle:"Options",listWindowRightTitle:"Selected",cell:"CGI/SAI",officDirection:"Office Direction",pleaseSelect:"Please select…",selectCell:"Select CGI/SAI",selectTopN:"Select Top N",allText:"All",pleaseSelectArea:"Please select the Area!",notEmpty:" cannot be empty.",onlyChartNum:"It can only be a number or a combination of 0-9,a-z,A-Z.",source:"Source:",destination:"Destination:",size:{lableWidth:90}},more:{windowTitle:"Select KPI",indicator:"Indicator",add:"Add","delete":"Delete",selectKpi:"Please select the Indicator!"},queryCondition:{query:"Query"},gridDrill:{cdrDrill:"CDR Details",failcauseDrill:"Failure Analysis",hocauseDrill:"Handover Cause Analysis"},line:{chartDisplay:"Chart Display",selectObject:"Select Object",indexLabelText:"Indicator",selectPeriod:"Select Period",multiObject:"Multi-Object Comparison",history:"History Comparison",timeDate:[[1,"1 day ago"],[2,"2 days ago"],[3,"3 days ago"],[4,"4 days ago"],[5,"5 days ago"],[6,"6 days ago"],[7,"7 days ago"]],currentPeriod:"Current period",size:{objBoxWidth:325,objBoxLabelWidth:100,indexWidth:300,indexLabelWidth:75,periodWidth:325,periodLabelWidth:100,radioWidth:350}},grid:{gridDisplay:"Report Details",counterTool:"Counter",sn:"SN"},conditionManage:{queryConditionHistory:"Select Query Conditions",queryConditionSave:"Save Query Conditions",queryConditionLast:"Last Query",inputTemplateName:"Please enter template name：",save:"Save",ok:"OK","delete":"Delete",noInput:"Only English letters, digits (0-9), underlines (_) and hyphens (-) are allowed.",saveTempletError:"Failed to save the template.",deleteTempletTips:'Are you sure you want to delete the template "{0}"?'},failCause:{baseTitle:"Failure Analysis",tabelName:"Signaling Records",leftPieTitle:"Cause Category",rightPieTitle:"Cause Analysis"}},BusinessI18NZH.comm={noInput:"输入模板名称不正确，请重新输入！支持 ! @ # ~ - _ ( ) [ ] . 字母 数字 中文 空格。",noInputLength:"模板名称的长度不能大于{0}个字符！",templateNameNotNull:"请输入模板名称！",template_Name:"模板名称",pleaseInput:"请输入...",privates:"个 人",publics:"公 共",saveTemplateSucc:"成功",saveTemplateSuccMsg:"模板保存成功.",saveTemplate:"保存模板",operation:"操作",operationWidth:50,importTemplate:"载入模板",templateName:"名称",templateType:"类型",templateOwner:"创建者",confirmDel:"确定要删除已选定的模板吗？",checkTemplate:"请选择模板！",cancel:"取消",OK:"确定",save:"保存"},BusinessI18NEN.comm={noInput:"The template name is incorrect,please enter again.Support ! @ # ~ - _ () [] . space and alphanumeric.",noInputLength:"The length of the template name cannot exceed {0} characters!",templateNameNotNull:"Please enter the template name!",template_Name:"Template Name",pleaseInput:"Please enter...",privates:"private",publics:"public",saveTemplateSucc:"Success",saveTemplateSuccMsg:"Template saved successfully.",saveTemplate:"Save Template",operation:"Operator",operationWidth:80,importTemplate:"Load Template",templateName:"Name",templateOwner:"Creator",templateType:"Type",confirmDel:"Are you sure to delete the template you selected?",checkTemplate:"please select a template！",cancel:"Cancel",save:"Save",OK:"OK"}})(),function(){var e=this;"undefined"==typeof Business&&(e.Business={}),Business.url={storeDuration:basePath+"businessWidget/storeDuration.action",serverDate:basePath+"businessWidget/serverDate.action",areaData:basePath+"businessWidget/area.action",moreData:basePath+"businessWidget/more.action",getPageConfig:basePath+"seqCommonController/getPageConfig.action",getData:basePath+"seqCommonController/getData.action",exportData:basePath+"seqCommonController/exportData.action",downLoad:basePath+"seqCommonController/downLoad.action",getTimeList:basePath+"seqCommonController/getTimeList.action",saveTemplate:basePath+"businessWidget/saveQueryTemplate.action",templateList:basePath+"businessWidget/getQueryTemplates.action",deleteTemplate:basePath+"businessWidget/deleteQueryTemplate.action"},Business.interval={day:86400,hour:3600,minutes:900},Business.areaData={areaType:{MSC_POOL:"MSC-POOL",MSC:"MSC",BSC:"BSC",RNC:"RNC",BSCRNC:"BSC/RNC",RNC_BSC:"RNC-BSC",SAI:"SAI",CGI:"CGI",CGISAI:BusinessI18N.cmp.area.cell,SAI_CGI:"SAI-CGI",OFFICE_DIRECTION:BusinessI18N.cmp.area.officDirection},areaTypeKey:["MSC_POOL","MSC","BSC","RNC","BSCRNC","RNC_BSC","SAI","CGI","CGISAI","SAI_CGI","CGISAI_CGISAI","OFFICE_DIRECTION"]},Business.imagePath={gridCdrDrill:basePath+"sweet/business-cmp/themes/images/drillDown.png",gridFailcauseDrill:basePath+"sweet/business-cmp/themes/images/drillDown.pngn",gridHocauseDrill:basePath+"sweet/business-cmp/themes/images/drillDown.png"},Business.saveCondition={templateNameLength:16}}(),function(){Business.functions={getLeafArray:function(e){var t=this;e=e||null;var i=t.oneObjToArray(e),a=t.getLeafNodeObj(i);return t.objArrToObj(a)},oneObjToArray:function(e){if(!e)return null;var t=[];return $.isArray(e)?t=e:$.isUndefined(e.value)||$.isUndefined(e.text)||t.push(e),t},getLeafNodeObj:function(e,t){var i=this;if(t=t||[],e){for(var a=0;e.length>a;a++)e[a].children?i.getLeafNodeObj(e[a].children,t):t.push(e[a]);return t}},objArrToObj:function(e){var t=this,i={},a="",n="",o="";if(!e)return i.text=a,i.value=n,i;for(var r=t.oneObjToArray(e),s=0;r.length>s;s++)o=$.isUndefined(r[s].text)?r[s].value:r[s].text,n=n+","+r[s].value,a=a+","+o;return i.text=a.substring(1,a.length),i.value=n.substring(1,n.length),i},requestDataByForm:function(e,t,i,a){var n,a,o;if(n=document.createElement("form"),n.name=i,n.action=e,n.method="post",a)n.target="_blank";else{if($.isNull(document.getElementById("fileSave"))){try{o=document.createElement('<iframe name="fileSave">')}catch(r){o=document.createElement("iframe")}o.id="fileSave",o.name="fileSave",o.width=0,o.height=0,o.marginHeight=0,o.marginWidth=0,o.x=-1e4,o.y=-1e4,o.style.display="none",document.body.appendChild(o)}n.target="fileSave"}for(var s in t){var l;l=n.appendChild(document.createElement("input")),l.type="hidden",l.name=s,l.value=t[s]}n.style.display="none",document.body.appendChild(n),n.submit(),$(n).empty()},unEscapeHtml:function(e){return e.replace(/&#x2F;/g,"/").replace(/&#x27;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")},drillFunc:function(e,t,i,a){i&&3>i.length&&i.forEach(function(e){e.align="left"});var n=e.columnName,o=e.rowData,r=o[n],s=e.type.value,l=e.type.text,d=$.objClone(t);d.title=l,d.type=s,d.drillCounter=n,d.drillCounterValue=r,d.drillRecord=o,d.columns=i,a&&a.indexOf(n)>=0&&delete d.drillCounterValue;var c=t.module,u="";u="xdr"===s?basePath+"seqCommonController/drillXdr.action":basePath+"pages/"+c+"/"+s+".jsp",u=u+"?params="+encodeURI(Business.functions.unEscapeHtml(JSON.stringify(d)));var h=t.module+"_"+t.feature+"_"+e.columnName;for(var p in o)h+="_"+o[p];var f=h.replace(RegExp(/[^_A-Za-z0-9]/g),"");f=f.replace(RegExp(/_{2,}/g),"_"),top.showTabPanelPost?top.showTabPanelPost(l,f,u):window.open(u)},creatGridFilterList:function(e,t){var i=[],a=[];if(t.forEach(function(e){if("list"===e.filterType){var t=e.name.indexOf("_NAME");t>-1?(i.push(e.name.slice(0,t)),a.push({})):e.filterType="string"}}),1>i.length)return t;e.forEach(function(e){i.forEach(function(t,i){a[i][e[t+"_ID"]]={text:e[t+"_NAME"],value:e[t+"_ID"]}})});var n=[];a.forEach(function(e){var t=[];for(var i in e)t.push(e[i]);n.push(t)});var o={};return i.forEach(function(e,t){o[e+"_NAME"]=n[t]}),t.forEach(function(e){"list"===e.filterType&&(e.filterList=o[e.name])}),$.objClone(t)}}}(),function(){Business.timeRange=function(e){return this.config={labelWidth:BusinessI18N.cmp.timeRange.size.timeLableWidth,timeBoxWidth:160,timeUnit:!0,timeschedule:!0,timescheduleWidth:128,hidden:!1,business:"csnpm",format:"yyyy-MM-dd hh:mm:ss",intervalData:Business.interval.day+","+Business.interval.hour+","+Business.interval.minutes,renderTo:null,isOneDay:!1,editable:!1},this.config=$.extend(this.config,e),this._initStoreDuration(!0),this._init(),this},Business.timeRange.prototype.getItems=function(){return this.items},Business.timeRange.prototype.getPanel=function(){var e=this,t=e.config,i={height:35,items:e.items,itemExtend:!1,padding:5,margin:[5,0,0,0]};return t.renderTo&&(i.renderTo=t.renderTo),e.panel=new Sweet.panel.HPanel(i),this.panel},Business.timeRange.prototype.getValue=function(){var e=this,t=e.config;if(e._valid()){var i={};if(i.startTime=e._startTimeBox.getValue().value,i.endTime=e._endTimeBox.getValue().value,t.timeUnit&&"false"!==t.timeUnit){var a=e._intervalBox.getValue().value;i.interval=a;var n=new Date(i.startTime.replace(/-/g,"/")),o=new Date(i.endTime.replace(/-/g,"/")),r=t.format;""+a==""+Business.interval.minutes&&(0!==n.getMinutes()%15&&(n.setMinutes(15*parseInt(n.getMinutes()/15)),e._startTimeBox.setValue({value:$.date.format(n,r),text:"time"}),e._startTimeBox.setRegularization(parseInt(a)),i.startTime=e._startTimeBox.getValue().value),0!==o.getMinutes()%15&&(o.setMinutes(15*(parseInt(o.getMinutes()/15)+1)),e._endTimeBox.setValue({value:$.date.format(o,r),text:"time"}),e._endTimeBox.setRegularization(parseInt(a)),i.endTime=e._endTimeBox.getValue().value))}return t.timeschedule&&"false"!==t.timeschedule&&(i.schedule=e._timeschedule.getValue()),i}return null},Business.timeRange.prototype.setValue=function(e){if(!$.isNull(e)){var t=this;$.isNotNull(e.interval)&&$.isNotNull(t._intervalBox)&&t._intervalBox.setValue({value:e.interval,text:BusinessI18N.cmp.timeRange["interval_"+e.interval]})}},Business.timeRange.prototype._init=function(){var e=this,t=e.config;e.items=[];var i=new Date(Date.parse(e._getServerDate().replace(/-/g,"/"))),a=i.getTime()/1e3,n=null,o=null;t.timeUnit&&"false"!==t.timeUnit||(n=a,o=n-3600),t.isOneDay&&(0===i.getHours()&&0===i.getMinutes()&&0===i.getSeconds()?o=i.setDate(i.getDate-1).getTime()/1e3:(i.setHours(0),i.setMinutes(0),i.setSeconds(0),o=i.getTime()/1e3));var r=t.labelWidth,s=t.timeBoxWidth;e._startTimeBox=new Sweet.form.Date({name:"startTime",editable:t.editable,width:s+r,label:!0,labelText:BusinessI18N.cmp.timeRange.timeRange,labelWidth:r,format:t.format,value:o?{value:o,text:"time"}:{value:null},beforePopDatePanel:function(){e._setStoreRange()}}),e.items.push(e._startTimeBox);var l=new Sweet.form.Label({align:Sweet.constants.align.Center,width:5,value:{text:"-",value:"",data:null}});if(e.items.push(l),e._endTimeBox=new Sweet.form.Date({name:"endTime",editable:t.editable,width:s,label:!1,format:t.format,value:n?{value:n,text:"time"}:{value:null},beforePopDatePanel:function(){e._setStoreRange()}}),e.items.push(e._endTimeBox),t.timeUnit&&"false"!==t.timeUnit){t.format="yyyy-MM-dd hh:mm",e._startTimeBox.setFiledType("S"),e._endTimeBox.setFiledType("S");var d=[],c=[];$.isNotNull(t.intervalData)&&(c=t.intervalData.split(","));for(var u=0,h=c.length;h>u;u++)d.push({value:c[u],text:BusinessI18N.cmp.timeRange["interval_"+c[u]]});e._intervalBox=new Sweet.form.ComboBox_v1({name:"interval",width:BusinessI18N.cmp.timeRange.size.intervalWidth,label:!0,labelText:BusinessI18N.cmp.timeRange.interval,labelWidth:BusinessI18N.cmp.timeRange.size.intervalLableWidth,multi:!1,visible:!0===t.hidden||"true"===t.hidden?!1:!0,tip:!0}),e._intervalBox.addListener("change",function(t,i){e._setTimeUnit(i)}),e.items.push(e._intervalBox),e._startTimeBox.addListener("click",function(){e._setDisableTimePart(e._startTimeBox)}),e._endTimeBox.addListener("click",function(){e._setDisableTimePart(e._endTimeBox)})}t.timeschedule&&"false"!==t.timeschedule&&(e._timeschedule=new Sweet.cmp.TimeSchedule({name:"timeschedule",width:t.timescheduleWidth,type:2,tip:!0}),e.items.push(e._timeschedule)),e._intervalBox&&e._intervalBox.setData(d)},Business.timeRange.prototype._setDisableTimePart=function(e){var t=this,i=""+t._intervalBox.getValue().value,a="";a=i===""+Business.interval.day?"yyyy-MM-dd":i===""+Business.interval.hour?"yyyy-MM-dd hh":i===""+Business.interval.minutes?"yyyy-MM-dd hh:mm":"yyyy-MM-dd hh:mm:ss",$.isNotNull(a)&&i&&e.setDisableTimePart(a)},Business.timeRange.prototype._setTimeUnit=function(e){var t=this,i=t.config.format,a=e.value;if(t.config.timeschedule&&"false"!==t.config.timeschedule){var n=a>=Business.interval.day;t._timeschedule.setDisabled(n)}var o=t._getMinMaxDate(),r=o.maxDate;t._endTimeBox.setValue({value:$.date.format(r,i),text:"time"}),t.config.isOneDay?0===r.getHours()&&0===r.getMinutes()&&0===r.getSeconds()?r.setDate(r.getDate-1):(r.setHours(0),r.setMinutes(0),r.setSeconds(0)):r.setDate(r.getDate()-7),t._startTimeBox.setValue({value:$.date.format(r,i),text:"time"}),t._endTimeBox.setRegularization(parseInt(a)),t._startTimeBox.setRegularization(parseInt(a))},Business.timeRange.prototype._setStoreRange=function(){var e=this,t=e._getMinMaxDate();e._startTimeBox.setMinDate(t.minDate.getTime()/1e3),e._startTimeBox.setMaxDate(t.maxDate.getTime()/1e3),e._endTimeBox.setMinDate(t.minDate.getTime()/1e3),e._endTimeBox.setMaxDate(t.maxDate.getTime()/1e3)},Business.timeRange.prototype._getMinMaxDate=function(){var e=this,t=e.config.business;e.config.timeUnit&&"false"!==e.config.timeUnit&&(t=e._intervalBox.getValue().value);var i=e._getStoreDuration(t),a=e._getServerDate(),n=new Date(Date.parse(a.replace(/-/g,"/"))),o=new Date(n.getFullYear(),n.getMonth(),n.getDate()-i),r=n;return""+t==""+Business.interval.day?r=new Date(n.getFullYear(),n.getMonth(),n.getDate()):""+t==""+Business.interval.hour?r=new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours()-1):""+t==""+Business.interval.minutes&&(r=new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),15*(parseInt(n.getMinutes()/15)-1))),{minDate:o,maxDate:r}},Business.timeRange.prototype._getServerDate=function(){var e="";return Sweet.Ajax.request({url:Business.url.serverDate,contentT:"application/json;chartset=UTF-8",async:!1,loadMask:!1,timeout:3e5,success:function(t){e=t.serverDate},error:function(){throw Error("Business.timeRange() request serverDate error!")}}),e},Business.timeRange.prototype._getStoreDuration=function(e){var t=this;if($.isNotNull(t.config.storeDays))return parseInt(t.config.storeDays);$.isNull(t._storeDuration)&&t._initStoreDuration(!1);var i=t._storeDuration[e];return $.isNull(i)?e===Business.interval.minutes?7:e===Business.interval.hour?30:60:parseInt(i)},Business.timeRange.prototype._initStoreDuration=function(e){var t=this;Sweet.Ajax.request({url:Business.url.storeDuration,contentT:"application/json;chartset=UTF-8",async:e,loadMask:!1,timeout:3e5,success:function(e){t._storeDuration={};var i=null;if($.isNotNull(t.config.intervalData)&&(i=t.config.intervalData.split(",")),$.isNull(i))t._storeDuration[t.config.business]=e[t.config.business];else for(var a in i)t._storeDuration[a]=e[t._getIntervalStoreKey(a)]},error:function(){throw Error("Business.timeRange() request storeDuration error!")}})},Business.timeRange.prototype._getIntervalStoreKey=function(e){return $.isNull(e)?"":Business.interval.day===e?me.config.business+"day":Business.interval.hour===e?me.config.business+"hour":Business.interval.minutes===e?me.config.business+"minute":""},Business.timeRange.prototype._valid=function(){var e=this,t=e._getMinMaxDate(),i=e._startTimeBox.getValue().data,a=e._endTimeBox.getValue().data;return t.minDate.getTime()/1e3>i?(Sweet.Msg.error(BusinessI18N.cmp.timeRange.timeStoreMsg.replace("{0}",$.date.format(t.minDate,"yyyy-MM-dd"))),!1):a>t.maxDate.getTime()/1e3||i>=a?(Sweet.Msg.error(BusinessI18N.cmp.timeRange.finalTimeMsg),!1):!0}}(),function(){var AREA_TYPE=Business.areaData.areaType,topNData=[50,100,200,300],ALL=BusinessI18N.cmp.area.allText,selectAreaError=BusinessI18N.cmp.area.pleaseSelectArea,splitMark="_",NEED_AREA_PAIR="area_pair",radioValue={list:"list",topN:"topN"},CMPTYPE={listWindow:"listWindow",treeWindow:"treeWindow",officeDirection:"officeDirection",sdListWindow:"sdListWindow",sdTreeWindow:"sdTreeWindow",imsiField:"imsiField"},windowSize={listWindow:[470,400],treeWindow:[470,400],officeDirection:[470,495],sdListWindow:[470,500],sdTreeWindow:[470,500],_paddingWidth:10,_tempHeight:71,_tempSDHeight:93},locale=Sweet.getLocale()===Sweet.constants.language.ZH_CN?"zh":"en",notEmpty=BusinessI18N.cmp.area.notEmpty;Business.area=function(e){if(this.config={labelText:BusinessI18N.cmp.area.labelText,lableWidth:50,comboWidth:120,areaTypeUrl:null,url:Business.url.areaData,officeDirection:[{opt:"MSC",dpt:["MSC"]}],imsiFieldLength:32,imsiFieldAllowedCharts:/^[0-9a-zA-Z]+$/,changeFunc:function(){return null}},e["labelText_"+locale]&&(e.labelText=e["labelText_"+locale]),this.config=$.extend(this.config,e),this._isTopN=!0,this.config.topN){if("true"!=this.config.topN&&1!=this.config.topN){topNData=[];var t=this.config.topN.split(",");t&&t.length>0&&(topNData=t)}}else this._isTopN=!1;return this._init(),this},Business.area.prototype.getItems=function(){return this.items},Business.area.prototype.getOriginalValue=function(){var e,t,i=this,a={areaType:$.objClone(i._combobox.getValue()),areaList:null,isTopN:null,topN:null};if(e=a.areaType.value,t=a.areaType.data&&a.areaType.data.cmpType?a.areaType.data.cmpType:null,CMPTYPE.imsiField===t)return a.areaList=i._imsiField.getValue(),a;if(CMPTYPE.listWindow===t)a.areaList=$.objClone(i._listWindow.getValue());else if(CMPTYPE.treeWindow===t)i._isTopN?(a.isTopN=i._cellRadioBtn.getValue(),radioValue.topN===a.isTopN.value?a.topN=i._cellComboBox.getValue():a.areaList=$.objClone(i._cellListWin.getValue())):a.areaList=$.objClone(i._cellListWin.getValue());else if(CMPTYPE.officeDirection===t)a.areaList=i._officeDirection.getAllSelValue();else if(CMPTYPE.sdListWindow===t)a.orgAreaList=i._sdListWinSTreeWindow.getValue(),a.targetAreaList=i._sdListWinDTreeWindow.getValue();else{if(CMPTYPE.sdTreeWindow!==t)return;a.orgAreaList=i._sdTreeWinSTreeWindow.getValue(),a.targetAreaList=i._sdTreeWinDTreeWindow.getValue()}return a.selector=i._selector.getValue(),a},Business.area.prototype.getValue=function(){var e=this,t=e.getOriginalValue(),i={areaType:t.areaType.value},a=t.areaType.data&&t.areaType.data.cmpType?t.areaType.data.cmpType:null,n=t.areaType.data&&t.areaType.data.mscType?t.areaType.data.mscType:null;if(CMPTYPE.imsiField===a){if(i.areaList=t.areaList.value,i.areaListObj=t.areaList,!i.areaList){var o=t.areaType.text+notEmpty;return locale||(o="The "+o),Sweet.Dialog.warn({width:330,height:130,message:o}),null}return e._imsiField.check()?i:(Sweet.Dialog.warn({width:330,height:130,message:t.areaType.text+": "+BusinessI18N.cmp.area.onlyChartNum}),null)}var r=e._selector.getValue()&&e._selector.getValue().value?e._selector.getValue().value:"";if(!r)return Sweet.Dialog.warn({width:330,height:130,message:selectAreaError}),null;if(CMPTYPE.listWindow===a){var s="",l=null;ALL===r?(s=-1,l=e._areaListData):(l=e._listWindow.getValue(),s=Business.functions.getLeafArray(l).value),i.areaList=s,i.areaListObj=l,n&&(i.mscType=n)}else if(CMPTYPE.treeWindow===a){if(i.isTopN=t.isTopN?radioValue.topN===t.isTopN.value?!0:!1:null,i.topN=t.topN?t.topN.value:null,i.isTopN)return i.areaList="-1",i.areaListObj=null,i;var l=Business.functions.oneObjToArray(t.areaList);l=Business.functions.getLeafNodeObj(l),i.areaListObj=l;var d=[],c=[];t.areaList.forEach(function(e){if(e.data===e.children.length)d.push(e.value);else{var t=Business.functions.getLeafArray(e.children).value,i=t.split(",");c=c.concat(i)}});var u={selectedBscrncId:""+d,selectedCgisaiId:""+c};i.areaListForCgisai=u}else if(CMPTYPE.officeDirection===a){var s="",l=null;if(ALL===r){s=-1;var h=t.areaList.source.value,p=t.areaList.destination.value;l=Business.functions.oneObjToArray(e._getAllOfficeList(h,p))}else l=e._officeDirection.getValue(),s=Business.functions.getLeafArray(l).value;i.areaList=s,i.areaListObj=l}else if(CMPTYPE.sdListWindow===a)i.orgAreaList=Business.functions.getLeafArray(t.orgAreaList).value,i.targetAreaList=Business.functions.getLeafArray(t.targetAreaList).value,i.areaListObj=NEED_AREA_PAIR;else{if(CMPTYPE.sdTreeWindow!==a)return i;var f=[],g=[];t.orgAreaList.forEach(function(e){if(e.data===e.children.length)f.push(e.value);else{var t=Business.functions.getLeafArray(e.children).value,i=t.split(",");g=g.concat(i)}});var u={orgSelectedBscrncId:""+f,orgSelectedCgisaiId:""+g};i.areaListForOrg=u;var m=[],v=[];t.targetAreaList.forEach(function(e){if(e.data===e.children.length)m.push(e.value);else{var t=Business.functions.getLeafArray(e.children).value,i=t.split(",");v=v.concat(i)}});var u={targetSelectedBscrncId:""+m,targetSelectedCgisaiId:""+v};i.areaListForTarget=u,i.areaListObj=NEED_AREA_PAIR}return i},Business.area.prototype.setValue=function(e){if(!$.isNull(e)&&!$.isNull(e.areaType)){var t=this,i=e.areaType;t._afterSetListWinRightData=null;var a=t._combobox.getValue().value;a!==i.value?(t._afterSetListWinRightData=e,t._combobox.setValue(i)):t._setListWindowValue(e)}},Business.area.prototype._init=function(){var e=this,t=e.config;e.cellLoader={contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:t.url,baseParams:{loadMask:!0,areaType:""}},e.items=[];var i=parseInt(t.lableWidth),a=parseInt(t.comboWidth);e._combobox=new Sweet.form.ComboBox_v1({tip:!0,name:"areaCombobox",editable:!1,width:i+a,label:!0,labelText:t.labelText,labelWidth:i}),e._combobox.addListener("click",function(t){e._oldClickComboValue&&e._oldClickComboValue===t.value||(e._oldClickComboValue=t.value,e._afterSetListWinRightData&&(e._afterSetListWinRightData=null))}),e._combobox.addListener("change",function(i,a){t.changeFunc(a),e._cleanAllListWindow();var n=a.data&&a.data.cmpType?a.data.cmpType:"";e._showWhichSelector(n),e._requestCmpTypeData(a.value),e._setListWindowValue(e._afterSetListWinRightData)}),e.items.push(e._combobox),e._creatSelector(),e._creatWindow(),e._requestData("",function(t){e._combobox.setData(t)},t.areaTypeUrl)},Business.area.prototype._creatSelector=function(){var e=this,t=e.config;e._selector=new Sweet.form.Selector({name:"areaSelector",emptyText:BusinessI18N.cmp.area.pleaseSelect,width:150}),e._selector.addListener("buttonClick",function(){e._openWindow()}),e.items.push(e._selector),e._imsiField=new Sweet.form.TextField({width:150,label:!1,maxLength:t.imsiFieldLength,visible:!1,errorModel:Sweet.constants.tipAttr.MODEL_NORMAL,validateFun:{eventName:"blur",params:{},fun:function(e,i){return i.text&&!t.imsiFieldAllowedCharts.test(i.text)?{success:!1,message:BusinessI18N.cmp.area.onlyChartNum}:{success:!0,message:""}}}}),e.items.push(e._imsiField)},Business.area.prototype._creatWindow=function(){var e=this;e.config,e._listWindow||e._creatListWindow(),e._treeWindow||e._creatTreeWindow(),e._officeDirection||e._creatOfficeDirectionWindow(),e._sdListWindow||e._creatSdListWindow(),e._sdTreeWindow||e._creatSdTreeWindow(),e._windowPanel=new Sweet.panel.VPanel({height:windowSize.listWindow[1]-windowSize._tempHeight,width:"100%",header:!1,padding:0,items:[e._listWindow,e._treeWindow,e._officeDirection,e._sdListWindow,e._sdTreeWindow]}),e._window=new Sweet.Window({width:windowSize.listWindow[0],height:windowSize.listWindow[1],padding:[3,5,5,5],content:e._windowPanel,listeners:{ok:function(){e._setSelectorValue()},cancel:function(){$.log("Cancel button clicked")}}})},Business.area.prototype._creatListWindow=function(){var e=this;e.config,e._listWindow=new Sweet.cmp.TreeWindow({name:"areaListWin",widgetClass:"business-cmp-listwindw-area",width:windowSize.listWindow[0]-windowSize._paddingWidth,height:windowSize.listWindow[1]-windowSize._tempHeight,useArrows:!1,icon:!1,tip:!0,fromTitle:BusinessI18N.cmp.area.listWindowLeftTitle,toTitle:BusinessI18N.cmp.area.listWindowRightTitle,visible:!1})},Business.area.prototype._creatTreeWindow=function(){var e=this;e.config;var e=this;e.config;var t,i=!1,a=$.objClone(e.cellLoader);if(e._isTopN?t=windowSize.listWindow[1]-windowSize._tempHeight-30:(i=!0,t=windowSize.listWindow[1]-windowSize._tempHeight),e._cellListWin=new Sweet.cmp.TreeWindow({width:windowSize.listWindow[0]-windowSize._paddingWidth,height:t,useArrows:!1,icon:!1,tip:!0,loader:a,visible:i,fromTitle:BusinessI18N.cmp.area.listWindowLeftTitle,toTitle:BusinessI18N.cmp.area.listWindowRightTitle}),e._cellListWin.addListener("beforemoveright",e._registEvent("beforemoveright",300)),e._cellListWin.addListener("beforeload",e._registEvent("beforeload","","CGISAI")),e._cellListWin.addListener("load",e._registEvent("load")),!e._isTopN)return e._treeWindow=new Sweet.panel.VPanel({height:windowSize.treeWindow[1]-windowSize._tempHeight,width:"100%",header:!1,items:[e._cellListWin],visible:!0}),void 0;e._cellRadioBtn=new Sweet.form.RadioGroup({width:parseInt(.7*windowSize.treeWindow[0],10),height:25,data:[{text:BusinessI18N.cmp.area.selectTopN,value:radioValue.topN,checked:!0},{text:BusinessI18N.cmp.area.selectCell,value:radioValue.list,checked:!1}]}),e._cellRadioBtn.addListener("change",function(t,i){if(radioValue.topN===i.value)e._cellListWin.hide(),e._cellComboBox.show();else{if(radioValue.list!==i.value)return;e._cellListWin.show(),e._cellListWin.doLayout(!0),e._cellComboBox.hide()}});var n=[];e._cellComboBox=new Sweet.form.ComboBox_v1({tip:!0,editable:!1,width:300,label:!0,labelText:"Top N",labelWidth:50,blank:!1}),topNData.forEach(function(e){n.push({text:""+e,value:""+e})}),e._cellComboBox.setData(n),e._treeWindow=new Sweet.panel.VPanel({height:windowSize.treeWindow[1],width:"100%",header:!1,items:[e._cellRadioBtn,e._cellListWin,e._cellComboBox],visible:!1})},Business.area.prototype._creatOfficeDirectionWindow=function(){var e=this;e.config,e._officeDirection=new Sweet.cmp.OfficeDirection({width:windowSize.officeDirection[0]-22,height:windowSize.officeDirection[1]-95,splitMark:splitMark,visible:!1,source:e._getOfficeComboData()})},Business.area.prototype._creatSdListWindow=function(){var e=this;e.config;var t=(windowSize.sdListWindow[1]-windowSize._tempSDHeight)/2;e._sdListWinSTreeWindow=new Sweet.cmp.TreeWindow({height:t,widgetClass:"business-cmp-listwindw-area",useArrows:!1,icon:!1,tip:!0,data:[],fromTitle:BusinessI18N.cmp.area.source,toTitle:""}),e._sdListWinDTreeWindow=new Sweet.cmp.TreeWindow({height:t,widgetClass:"business-cmp-listwindw-area",useArrows:!1,icon:!1,tip:!0,data:[],fromTitle:BusinessI18N.cmp.area.destination,toTitle:""}),e._sdListWinSTreeWindow.addListener("beforemoveright",e._registEvent("beforemoveright",100)),e._sdListWinDTreeWindow.addListener("beforemoveright",e._registEvent("beforemoveright",100)),e._sdListWindow=new Sweet.panel.VPanel({padding:20,visible:!1,items:[e._sdListWinSTreeWindow,e._sdListWinDTreeWindow]})},Business.area.prototype._creatSdTreeWindow=function(){var e=this;e.config;var t=(windowSize.sdTreeWindow[1]-windowSize._tempSDHeight)/2,i=$.objClone(e.cellLoader);i.baseParams.areaType="SAI";var a=$.objClone(e.cellLoader);a.baseParams.areaType="CGI",e._sdTreeWinSTreeWindow=new Sweet.cmp.TreeWindow({height:t,widgetClass:"business-cmp-listwindw-area",useArrows:!1,icon:!1,tip:!0,loader:i,fromTitle:BusinessI18N.cmp.area.source,toTitle:""}),e._sdTreeWinDTreeWindow=new Sweet.cmp.TreeWindow({height:t,widgetClass:"business-cmp-listwindw-area",useArrows:!1,icon:!1,tip:!0,loader:a,fromTitle:BusinessI18N.cmp.area.destination,toTitle:""}),e._sdTreeWinSTreeWindow.addListener("beforemoveright",e._registEvent("beforemoveright",100)),e._sdTreeWinSTreeWindow.addListener("beforeload",e._registEvent("beforeload","","SAI")),e._sdTreeWinSTreeWindow.addListener("load",e._registEvent("load","","SAI")),e._sdTreeWinDTreeWindow.addListener("beforemoveright",e._registEvent("beforemoveright",100)),e._sdTreeWinDTreeWindow.addListener("beforeload",e._registEvent("beforeload","","CGI")),e._sdTreeWinDTreeWindow.addListener("load",e._registEvent("load","","CGI")),e._sdTreeWindow=new Sweet.panel.VPanel({padding:20,visible:!1,items:[e._sdTreeWinSTreeWindow,e._sdTreeWinDTreeWindow]})},Business.area.prototype._showWhichSelector=function(e){var t=this;if(t.config,t._imsiField&&t._imsiField.rendered&&t._imsiField.hide(),t._selector&&t._selector.rendered&&t._selector.hide(),CMPTYPE.imsiField===e){if(t._imsiField.rendered){if(t._imsiField.show(),!t._afterSetListWinRightData)return t._imsiField.setValue({text:"",value:""}),void 0;t._imsiField.setValue(t._afterSetListWinRightData.areaList),t._afterSetListWinRightData=null}}else if(t._selector.rendered){var i={};t._afterSetListWinRightData?i=t._afterSetListWinRightData.selector:CMPTYPE.listWindow===e?i={text:ALL,value:ALL}:CMPTYPE.treeWindow===e?i={text:"",value:""}:CMPTYPE.officeDirection===e?i={text:ALL,value:ALL}:CMPTYPE.sdListWindow===e?i={text:"",value:""}:CMPTYPE.sdTreeWindow===e&&(i={text:"",value:""}),t._selector.setValue(i),t._selector.show()}else CMPTYPE.listWindow===e&&(i={text:ALL,value:ALL}),t._selector&&t._selector.setValue(i)},Business.area.prototype._openWindow=function(){var me=this,config=me.config,val=me._combobox.getValue(),cmpType=val.data.cmpType;me._windowPanel.setWidth(windowSize[cmpType][0]-windowSize._paddingWidth),me._windowPanel.setHeight(windowSize[cmpType][1]),me._window.setWidth(windowSize[cmpType][0]),me._window.setHeight(windowSize[cmpType][1]),me._hideAllWindowItems(),eval("me._"+cmpType+".show()"),me._window.setTitle(val.text),me._window.show()},Business.area.prototype._hideAllWindowItems=function(){var e=this;e.config,e._listWindow.hide(),e._treeWindow.hide(),e._officeDirection.hide(),e._sdListWindow.hide(),e._sdTreeWindow.hide()},Business.area.prototype._requestCmpTypeData=function(){var e=this;e.config;var t=e._combobox.getValue(),i=t.data.cmpType;if(e._nowAreaType!==t.value)if(e._nowAreaType=t.value,CMPTYPE.listWindow===i)e._requestData(t.value,function(i){e._listWindow.setData(i[0][t.value]),e._areaListData=i[0][t.value]});else if(CMPTYPE.treeWindow===i){var a=$.objClone(e.cellLoader);a.baseParams.areaType=t.value,e._cellListWin.setLoader(a),e._cellListWin.load()}else if(CMPTYPE.officeDirection===i)e._requestData(e._getOfficeRequestParams(),function(t){var i={};t.forEach(function(e){var t=Object.keys(e);if(1===t.length){var a=t[0];i[a]=e[a]}}),e._officeDirection.setData(i)});else if(CMPTYPE.sdListWindow===i){var n=t.value.split("_")[0],o=t.value.split("_")[1];e._requestData(n+"-"+o,function(t){e._sdListWinSTreeWindow.setData(t[0][n]),e._sdListWinDTreeWindow.setData(t[0][o])})}else{if(CMPTYPE.sdTreeWindow!==i)return;var r=$.objClone(e.cellLoader),s=$.objClone(e.cellLoader);r.baseParams.areaType=e._nowAreaType.split("_")[0],s.baseParams.areaType=e._nowAreaType.split("_")[1],e._sdTreeWinSTreeWindow.setLoader(r),e._sdTreeWinDTreeWindow.setLoader(s),e._sdTreeWinSTreeWindow.load(),e._sdTreeWinDTreeWindow.load()
}},Business.area.prototype._registEvent=function(e,t,i){var a={};return a.beforemoveright=function(e){var i=!0,a=Business.functions.getLeafNodeObj(Business.functions.oneObjToArray(e));if(e.length>1&&a.length>t&&(i=!1),!i){var n=Sweet.core.i18n.list.maxRemains;return Sweet.Msg.warn(n.replace("{0}",t)),!1}return!0},a.beforeload=function(e){if(e.tParams){var t=e.baseParams;e.tParams.filter?t.filter=e.tParams.filter:e.tParams.node&&(t.bscrnc_id=e.tParams.node.value),e.baseParams=t}},a.load=function(e){var t=function(e){var t=[];if(!e)return t;for(var i={},a=0;e.length>a;a++){var n={value:e[a].value,text:e[a].text,leaf:!0},o=i[e[a].parentvalue];o?o.children.push(n):i[e[a].parentvalue]={value:e[a].parentvalue,text:e[a].parenttext,expanded:!0,loaded:!0,children:[n]}}for(var r in i)t.push(i[r]);return t};return i=e.baseParams.areaType,e&&e.tParams&&e.tParams.filter&&!e.tParams.node?(e.datas=i?e.datas&&e.datas.length>0?t(e.datas[0][i]):[]:t(e.datas),e.datas):(i&&(e.datas=e.datas&&e.datas.length>0?e.datas[0][i]:[]),e.datas)},a[e]},Business.area.prototype._requestData=function(e,t,i,a){var n=this,o=n.config;Sweet.Ajax.request({url:i||o.url,loadMask:!0,async:a||!1,data:{areaType:e},timeout:3e5,success:function(e){t(e)},error:function(){$.error("Business.area() request listWindow's data error!")}})},Business.area.prototype._setListWindowValue=function(e){if(e){var t=this,i=e.areaType,a=e.areaList,n=i.data&&i.data.cmpType?i.data.cmpType:null;if(CMPTYPE.imsiField===n)return t._imsiField.setValue(a),t._afterSetListWinRightData=null,void 0;if(CMPTYPE.listWindow===n)t._listWindow.setValue(a);else if(CMPTYPE.treeWindow===n){var o=e.isTopN,r=e.topN;t._isTopN?(t._cellRadioBtn.setValue(o),radioValue.topN===o.value?t._cellComboBox.setValue(r):t._cellListWin.setValue(a)):t._cellListWin.setValue(a)}else CMPTYPE.officeDirection===n?t._officeDirection.setValue(a):CMPTYPE.sdListWindow===n?(t._sdListWinSTreeWindow.setValue(e.orgAreaList),t._sdListWinDTreeWindow.setValue(e.targetAreaList)):CMPTYPE.sdTreeWindow===n&&(t._sdTreeWinSTreeWindow.setValue(e.orgAreaList),t._sdTreeWinDTreeWindow.setValue(e.targetAreaList));!e.selector.value||"全选"!=e.selector.value&&"All"!=e.selector.value?t._selector.setValue(e.selector):t._selector.setValue({text:ALL,value:ALL}),t._afterSetListWinRightData=null}},Business.area.prototype._setSelectorValue=function(){var e=this,t=e._combobox.getValue(),i=t.data.cmpType,a={text:ALL,value:ALL},n="";if(CMPTYPE.listWindow===i)n=$.objClone(e._listWindow.getValue()),n=e._areaListData&&e._areaListData.length>0&&n.length>=e._areaListData.length?"":Business.functions.getLeafArray(n).text;else if(CMPTYPE.treeWindow===i)e._isTopN&&radioValue.topN===e._cellRadioBtn.getValue().value?(n=$.objClone(e._cellComboBox.getValue()),n.text="Top "+n.text):n=$.objClone(e._cellListWin.getValue()),n=Business.functions.getLeafArray(n).text,a={text:"",value:""};else if(CMPTYPE.officeDirection===i)n=$.objClone(e._officeDirection.getValue()),n=Business.functions.getLeafArray(n).text;else if(CMPTYPE.sdListWindow===i){n=$.objClone(e._sdListWinSTreeWindow.getValue()),n=Business.functions.getLeafArray(n);var o=$.objClone(e._sdListWinDTreeWindow.getValue());o=Business.functions.getLeafArray(o),n=n.text&&o.text?n.text+","+o.text:n.text&&!o.text?n.text:!n.text&&o.text?va2.text:"",a={text:"",value:""}}else{if(CMPTYPE.sdTreeWindow!==i)return;n=$.objClone(e._sdTreeWinSTreeWindow.getValue()),n=Business.functions.getLeafArray(n);var o=$.objClone(e._sdTreeWinDTreeWindow.getValue());o=Business.functions.getLeafArray(o),n=n.text&&o.text?n.text+","+o.text:n.text&&!o.text?n.text:!n.text&&o.text?va2.text:"",a={text:"",value:""}}n=n?{text:n,value:n}:a,e._selector.setValue(n||a)},Business.area.prototype._getOfficeComboData=function(){var e=this,t=e.config,i=t.officeDirection,a=[];return i.forEach(function(e){var t={};t.value=e.opt,t.text=AREA_TYPE[e.opt],t.data=[],e.dpt.forEach(function(e){t.data.push({value:e,text:AREA_TYPE[e]})}),a.push(t)}),a},Business.area.prototype._getOfficeRequestParams=function(){var e=this,t=e.config,i=t.officeDirection,a={},n="";i.forEach(function(e){a[e.opt]=e.opt,e.dpt.forEach(function(e){a[e]=e})});var o=""+Object.keys(a),r=o.split(",");return n=1===r.length?r[0]+"-"+r[0]:r.join("-")},Business.area.prototype._getAllOfficeList=function(){var e=this,t=[],i=e._officeDirection.getOData(),a=e._officeDirection.getDData();return i.forEach(function(e){a.forEach(function(i){if(e.value!==i.value){var a=e.value+splitMark+i.value,n=e.text+"-"+i.text;t.push({text:n,value:a})}})}),t.length>0?t:[]},Business.area.prototype._cleanAllListWindow=function(){var e=this;e.config,e._imsiField.setValue({value:"",text:""}),e._listWindow.setValue([]),e._isTopN&&(e._cellRadioBtn.setValue({value:radioValue.topN}),e._cellComboBox.setValue({text:topNData[0]+"",value:topNData[0]+""})),e._cellListWin.setValue([]),e._officeDirection.clearData(),e._sdListWinSTreeWindow.setValue([]),e._sdListWinDTreeWindow.setValue([]),e._sdTreeWinSTreeWindow.setValue([]),e._sdTreeWinDTreeWindow.setValue([])}}(),function(){var INDICATOR=BusinessI18N.cmp.more.indicator;Business.more=function(e){return this.config={winWidth:600,winHeight:500,buttonText:BusinessI18N.cmp.more.windowTitle,url:Business.url.moreData,defaultType:!0,outerCmpName:"",clickMoreFunc:function(){return null},getParamsFunc:function(){return null}},this.config=$.extend(this.config,e),this._init(),this},Business.more.prototype.areaChangeFunc=function(e){var t=this,i=t.config;return i.defaultType?t._areaChangeFunc(e):t._outerMore.areaChangeFunc(e)},Business.more.prototype.getTabInfo=function(){var e=this,t=e.config;return t.defaultType?e._getTabInfo():e._outerMore.getTabInfo()},Business.more.prototype.getItems=function(){return this.items},Business.more.prototype.getOriginalValue=function(){var e=this,t=e.config,i={};return i=t.defaultType?e._indicatorTree.getValue():e._outerMore.getOriginalValue()},Business.more.prototype.getValue=function(){var e=this,t=e.config,i={};if(t.defaultType){var a=[],n=e._indicatorTree.getValue();n=Business.functions.getLeafNodeObj(n);for(var o=0;n.length>o;o++)a.push({indicator:n[o].value,indicatorName:n[o].text,indicatorNameEn:n[o].data});i.diffTabInfoArr=a}else i=e._outerMore.getValue();return i},Business.more.prototype.setValue=function(e){var t=this,i=t.config;if(i.defaultType){if(e.length>0){var a=t._getIndicatorTreeData(i);e=t._resetTreenew(e,a)}t._indicatorTree.setValue(e),t.indicatortemplate={},t.indicatortemplate[i.getParamsFunc().areaType]=e}else if(!i.defaultType&&i.outerCmpName){if(!$.isNull(e)){t._outerMore._requestData(t.config.getParamsFunc().areaType,!0);var n=t._outerMore.resKpidata;t._outerMore.resetKpidata(n,e)}t._outerMore.setValue(e)}else t._outerMore.setValue(e)},Business.more.prototype._init=function(){var me=this,config=me.config,winTitle=config.buttonText;if(me.isLoad={},me.items=[],config.defaultType="false"===config.defaultType||!1===config.defaultType?!1:!0,config.defaultType)me._initDefault(),config.defaultType=!0;else{if(config.defaultType||!config.outerCmpName)return;var outerCmpFunc=eval(config.outerCmpName);if("function"!=typeof outerCmpFunc)return;me._outerMore=new outerCmpFunc(me),me._morePanel=me._outerMore.getPanel(),config=$.extend(config,me._outerMore.getConfig())}me._moreWin=new Sweet.Window({width:config.winWidth,height:config.winHeight,header:config.header,widgetClass:" moreWindow",title:winTitle,content:me._morePanel,buttons:config.buttons||null,listeners:{ok:function(){config.defaultType||me._outerMore.clickOkBtn()},cancel:function(e){config.defaultType||me._outerMore.clickCancelBtn(e)}}}),me._moreButton=new Sweet.form.Button({width:85,widgetClass:"fontBolder",value:{value:"more",text:winTitle},click:function(){config.defaultType?me._requestDefaultData(config.getParamsFunc()):config.clickMoreFunc(config.getParamsFunc()),me._moreWin.show(),me._indicatorTree&&me._indicatorTree.doLayout(!0)}}),me.items.push(me._moreButton)},Business.more.prototype._initDefault=function(){var e=this,t=e.config;e.isLoad={},e.items=[],e._indicatorTree=new Sweet.cmp.TreeWindow({width:t.winWidth-22,height:t.winWidth-205,title:INDICATOR,widgetClass:"indicatorTree",tip:!0,useArrows:!1,valueKeys:["value","text","data"],icon:!1,fromTitle:BusinessI18N.cmp.area.listWindowLeftTitle,toTitle:BusinessI18N.cmp.area.listWindowRightTitle}),e._morePanel=new Sweet.panel.TabPanel({width:"100%",height:"100%",padding:[0,5,0,5],items:[e._indicatorTree],style:2})},Business.more.prototype._requestDefaultData=function(e){var t=this,i=t.config;t.areaType&&t.areaType===e.areaType||(t.areaType=e.areaType,Sweet.Ajax.request({url:i.url,loadMask:!0,async:!1,data:e,timeout:3e5,success:function(e){t._indicatorTree.setData(e),t.indicatortemplate&&t.indicatortemplate[t.areaType]&&t._indicatorTree.setValue(t.indicatortemplate[t.areaType]),t.indicatortemplate=null},error:function(){t.indicatortemplate=null,$.error("Business.more() request listWindow's data error!")}}))},Business.more.prototype._getTabInfo=function(){var e=this;e.config;var t=[],i=e.getOriginalValue();return i.forEach(function(e){var i={graphKey:"STARTTIME,AREA_NAME,AREA_ID",graphType:"line",text_zh:e.text,text_en:e.data,type:"list"};t.push(i)}),!t||1>t.length?(Sweet.Dialog.warn({width:330,height:130,message:BusinessI18N.cmp.more.selectKpi}),null):t},Business.more.prototype._areaChangeFunc=function(){var e=this;return e._indicatorTree&&e._indicatorTree.setValue(null),null},Business.more.prototype._getIndicatorTreeData=function(e){var t=this,i=[];return Sweet.Ajax.request({url:e.url,loadMask:!0,async:!1,data:e.getParamsFunc(),timeout:3e5,success:function(e){i=e},error:function(){t.indicatortemplate=null,$.error("Business.more() request listWindow's data error!")}}),i},Business.more.prototype._resetTreenew=function(e,t){for(var i=this,a=[],n=0;e.length>n;n++)for(var o=e[n],r=0;t.length>r;r++){var s=t[r];if(o.value==s.value){if(o.children){var l=s.children,d=o.children;i._resetTreeNext(d,l,s)}a.push(s)}}return a},Business.more.prototype._resetTreeNext=function(e,t,i){for(var a=this,n=[],o=0;e.length>o;o++)for(var r=e[o],s=0;t.length>s;s++){var l=t[s];r.value==l.value&&(r.children&&a._resetTreeNext(r.children,l.children,l),n.push(l))}i.children=n}}(),function(){Business.queryCondition=function(e){return this.config={boxWidth:195,boxLableWidth:75},this.config=$.extend(this.config,e),this._init(),this},Business.queryCondition.prototype.getPanel=function(){return this._panel},Business.queryCondition.prototype.getConditionManage=function(){return this._conditionManag},Business.queryCondition.prototype.getValue=function(){var e=this;if(e._value={},$.isNotNull(e._timeRange)){var t=e._timeRange.getValue();if(!t)return null;e._value=$.extend(e._value,t)}if($.isNotNull(e._area)){var i=e._area.getValue();if(!i)return null;e._value=$.extend(e._value,i)}return e._box&&(e._value=$.extend(e._value,{box:Business.functions.getLeafArray(e._box.getValue()).value})),e._more&&(e._value=$.extend(e._value,e._more.getValue())),e._value},Business.queryCondition.prototype.setValue=function(e){$.isNull(e)},Business.queryCondition.prototype._init=function(){var e=this,t=e.config;if(e.items=[],$.isNotNull(t.timeRange)&&(e._timeRange=new Business.timeRange(t.timeRange),e.items=e.items.concat(e._timeRange.getItems())),$.isNotNull(t.area)&&(t.area.changeFunc=function(t){e._more&&e._more.areaChangeFunc(t)},e._area=new Business.area(t.area),e.items=e.items.concat(e._area.getItems())),$.isNotNull(t.box)){var i={width:t.boxWidth,multi:!1,tip:!0,label:!0,labelWidth:t.boxLableWidth};i=$.extend(i,t.box),i.multi="true"===i.multi?!0:!1,e._box=new Sweet.form.ComboBox_v1(i),e.items=e.items.concat(e._box),Sweet.Ajax.request({url:i.url,contentType:"application/json;chartset=UTF-8",async:!0,timeout:3e5,success:function(t){$.isNull(t)&&$.error("Business.queryCondition() request combobox data fail"),e._box.setData(t)},error:function(){$.error("Business.queryCondition() request combobox data fail")}})}$.isNotNull(t.more)&&(e._more=new Business.more($.extend(t.more,{getParamsFunc:function(){var t=e._area&&e._area._combobox.getValue().value?e._area._combobox.getValue().value:null,i={areaType:t};return i}})),e.items=e.items.concat(e._more.getItems())),e._queryBtn=new Sweet.form.Button({width:105,highLight:!0,widgetClass:"queryBtnClass fontBolder",value:{value:"query",text:BusinessI18N.cmp.queryCondition.query},click:function(t,i){e._submitQueryData(t,i)&&queryModel.lastQuery(e.config.moduleId,e._getRequestParams())}}),e.items=e.items.concat(e._queryBtn),e._conditionManag=new Business.conditionManage({moduleId:t.moduleId,getCondtionCallback:function(){return e._getRequestParams()},setCondtionCallback:function(t){e._setQueryCondtions(t)}}),e.items=e.items.concat(e._conditionManag.getItems()),e._panel=new Sweet.panel.FlowPanel({height:35,portion:"north",widgetClass:"queryPanelLineClass",items:e.items,margin:[5,0,0,0]})},Business.queryCondition.prototype._getRequestParams=function(){var e=this,t=e.config,i={};return $.isNotNull(t.timeRange)&&(i.timeRange=$.objClone(e._timeRange.getValue()),!i.timeRange)?null:$.isNotNull(t.area)&&(i.area=$.objClone(e._area.getOriginalValue()),!i.area)?null:$.isNotNull(t.box)&&(i.box=$.objClone(e._box.getValue()),!i.box)?null:$.isNotNull(t.more)&&(i.more=$.objClone(e._more.getOriginalValue()),!i.more)?null:i},Business.queryCondition.prototype._setQueryCondtions=function(e){var t=this;$.isNull(e)||(e.timeRange&&t._timeRange&&t._timeRange.setValue(e.timeRange),e.area&&t._area&&t._area.setValue(e.area),e.box&&t._box&&t._box.setValue(e.box),e.more&&t._more&&t._more.setValue(e.more))},Business.queryCondition.prototype._submitQueryData=function(){var e=this,t=e.config,i=e.getValue();if(!i)return!1;if(t.validatorFunc&&"function"==typeof t.validatorFunc){var a=t.validatorFunc(i,e);if("false"===a||!1===a)return}return t.queryFunc(i),!0},Business.queryCondition.prototype.destroy=function(){this._panel&&(this._panel.destroy(),this._panel=null)}}(),function(){Business.conditionManage=function(e){return this.config={moduleId:"",width:250,height:215,getCondtionCallback:null,setCondtionCallback:null},this.config=$.extend(this.config,e),this._init(),this},Business.conditionManage.prototype.importLastQuery=function(e){var t=this,i={businessType:"NPM",isLast:!0,moduleId:e},a=function(e){if(e.length>0){var i=$.parseJSON(e[0].filter);if($.isNull(t.config.setCondtionCallback)||!$.isFunction(t.config.setCondtionCallback))return;t.config.setCondtionCallback(i)}};Sweet.Ajax.request({url:basePath+"/templateManageController/getQueryTemplateList.action",contentType:"application/json;chartset=UTF-8",data:JSON.stringify(i),dataType:"json",async:!1,timeout:3e5,success:function(e){$.isFunction(a)&&a(e)},error:function(e,t,i){$.error(url),$.error("Get data error. XMLHttpRequest = "+e+", error = "+i)}})},Business.conditionManage.prototype.saveTemplate=function(e,t,i){var a=this;i=$.isNull(i)?!1:!0;var n=/^[\u0391-\uFFE5\w_-]*$/;if(!i&&($.isNull(e)||!n.test(e)||0===e.length))return Sweet.Msg.error(BusinessI18N.cmp.conditionManage.noInput),void 0;if(!$.isNull(t)){if(!i&&a.isTemplateExist(e))return Sweet.Msg.error(BusinessI18N.cmp.conditionManage.saveTempletExistError),void 0;i&&(e=BusinessI18N.cmp.conditionManage.queryConditionLast);var o={moduleId:a.config.moduleId,templateName:e,widgetValue:t};Sweet.Ajax.request({url:Business.url.saveTemplate,contentType:"application/json;chartset=UTF-8",async:!0,data:JSON.stringify(o),loadMask:!i,success:function(e){return e===!1?(Sweet.Msg.error(BusinessI18N.cmp.conditionManage.saveTempletError),void 0):(a._queryTemplates(),a._updateListView(),void 0)},error:function(){Sweet.Msg.error(BusinessI18N.cmp.conditionManage.saveTempletError)}})}},Business.conditionManage.prototype.getItems=function(){return this.items},Business.conditionManage.prototype.getValue=function(){var e={};return e},Business.conditionManage.prototype.setValue=function(e){$.isNull(e)},Business.conditionManage.prototype.destroy=function(){},Business.conditionManage.prototype._init=function(){var e=this;e.items=[],e._historyIcon=new Sweet.form.LabelImage({imageType:"import",imageTip:BusinessI18N.cmp.conditionManage.queryConditionHistory,width:20,height:20,click:function(){queryModel.getQueryModel(e)}}),e.items.push(e._historyIcon),e._saveIcon=new Sweet.form.LabelImage({imageType:"save",imageTip:BusinessI18N.cmp.conditionManage.queryConditionSave,width:20,height:20,click:function(){queryModel.saveTemplate(e.config,e.config.getCondtionCallback())}}),e.items.push(e._saveIcon)},Business.conditionManage.prototype._onClickHistory=function(){var e=this,t={width:e.config.width-20,height:e.config.height-20,padding:"10px"};if($.isNull(e.historyEl)){var i=e._historyIcon.options.id+"-history";e.historyEl=$("<div>").attr("id",i).addClass("sweet-dialog-bg").css(t).css({display:"none"}).appendTo($(document.body)),e.historylist=new Sweet.list.List({data:[],minRemains:1,tip:!0,renderTo:i}),e.historylist.addListener("nodeClick",function(t,i){e.historyEl.hide(),!$.isNull(e.config.setCondtionCallback)&&$.isFunction(e.config.setCondtionCallback)&&e.config.setCondtionCallback(JSON.parse(i.widgetValue))}),$(document.body).bind("click",function(){$.isNotNull(e.historyEl)&&$.isVisiable(e.historyEl)&&!e._showHisFloatWinFlag&&e.historyEl.hide(),e._showHisFloatWinFlag=!1})}if(!$.isVisiable(e.historyEl)){$.isNull(e.templateList)&&e._queryTemplates(),e._updateHistoryList();var a=e._historyIcon.getWidgetEl(),n=$.getFloatOffset(a,e.historyEl,!0);t=$.extend(t,n),t.top=t.top+12,e._showHisFloatWinFlag=!0,e.historyEl.css(t).show()}},Business.conditionManage.prototype.filterQuery=function(e){var t=this,i=$.parseJSON(e);!$.isNull(t.config.setCondtionCallback)&&$.isFunction(t.config.setCondtionCallback)&&t.config.setCondtionCallback(i)},Business.conditionManage.prototype._onClickSave=function(){var e=this;$.isNull(e.window)&&e._creatManageWindow(),$.isNull(e.templateList)&&e._queryTemplates(),e._updateListView();var t=e._historyIcon.getWidgetEl(),i=t.offset(),a=i.left+t.width(),n=i.top+t.height()+10,o=a-e.config.width+2,r=n;this.manageWindow.show(o,r+2)},Business.conditionManage.prototype._creatManageWindow=function(){var e=this;e.nameInput=new Sweet.form.TextField({width:160,emptyText:BusinessI18N.cmp.conditionManage.inputTemplateName,maxLength:Business.saveCondition.templateNameLength});var t=new Sweet.form.Button({width:65,value:{value:"",text:BusinessI18N.cmp.conditionManage.save},click:function(){var t=e.nameInput.getValue().value;if(!$.isNull(e.config.getCondtionCallback)&&$.isFunction(e.config.getCondtionCallback)){var i=e.config.getCondtionCallback();e.saveTemplate(t,i)}}}),i=new Sweet.panel.HPanel({width:"100%",height:25,itemExtend:!1,items:[e.nameInput,t]});e.listView=new Sweet.panel.VPanel({width:"100%",height:130,padding:2,items:[],widgetClass:"query-bar-inter-list"});var a=new Sweet.panel.VPanel({width:"100%",height:"100%",items:[i,e.listView]}),n=new Sweet.form.Button({width:65,value:{value:"",text:BusinessI18N.cmp.conditionManage.ok},click:function(){e.manageWindow.hide()}});e.manageWindow=new Sweet.Window({header:!1,modal:!0,content:a,width:e.config.width,height:e.config.height,buttons:[n]})},Business.conditionManage.prototype.isTemplateExist=function(e){var t=this;if($.isNull(t.templateList))return!1;for(var i=0;t.templateList.length>i;i++)if(e===t.templateList[i].templateName)return!0;return!1},Business.conditionManage.prototype._queryTemplates=function(){var e,t=this;e={moduleId:t.config.moduleId,templateName:""},t.templateList=[],Sweet.Ajax.request({url:Business.url.templateList,contentType:"application/json;chartset=UTF-8",async:!1,data:JSON.stringify(e),loadMask:!1,timeout:3e5,success:function(e){t.templateList=e},error:function(){Sweet.Msg.error("Error")}})},Business.conditionManage.prototype._updateHistoryList=function(){for(var e=this,t=[],i=[],a=0,n=e.templateList.length;n>a;a++)e.templateList[a].templateName===BusinessI18N.cmp.conditionManage.queryConditionLast?i.push({text:e.templateList[a].templateName,value:e.templateList[a].templateName,widgetValue:e.templateList[a].widgetValue}):t.push({text:e.templateList[a].templateName,value:e.templateList[a].templateName,widgetValue:e.templateList[a].widgetValue});t=$.merge(i,t),e.historylist.setData(t)},Business.conditionManage.prototype._updateListView=function(){var e,t,i,a,n=this,o=[];if(n.listView){n.listView.removeItems();for(var r=0;n.templateList.length>r;r++){var e=n.templateList[r].templateName;e!==BusinessI18N.cmp.conditionManage.queryConditionLast&&(i=new Sweet.form.Label({width:"90%",height:23,tip:!0,value:{text:e,value:e}}),a=new Sweet.form.LabelImage({imageType:"delete",width:"10%",height:23,imageTip:BusinessI18N.cmp.conditionManage.delete,value:{text:e,value:e},click:function(e,t){var i=t.value;Sweet.Dialog.confirm({width:330,height:130,modal:!1,message:BusinessI18N.cmp.conditionManage.deleteTempletTips.replace("{0}",i),listeners:{ok:function(){n._removeTemplate(i)},cancel:function(){}}})}}),t=new Sweet.panel.HPanel({width:"100%",height:23,itemExtend:!1,items:[i,a]}),o.push(t))}o.length>0&&this.listView.addItems(o)}},Business.conditionManage.prototype._removeTemplate=function(e){var t=this,i={moduleId:t.config.moduleId,templateName:e};Sweet.Ajax.request({url:Business.url.deleteTemplate,data:JSON.stringify(i),async:!1,contentType:"application/json;chartset=UTF-8",success:function(){t._queryTemplates(),t._updateListView()},error:function(){Sweet.Msg.error("Error")}})}}(),function(){Business.failureReport=function(e,t){return this.config={renderTo:"",panelTitle:BusinessI18N.cmp.failCause.baseTitle,panelToolText:"需要添加:业务相关信息:",leftBalloonText:"",rightBalloonText:"",pieKeys:{leftPieId:"FAILCAUSE_AIU_CLASS",leftPieName:"FAILCAUSE_AIU_CLASS_ZH",rightPieId:"FAILCAUSE_AIU_PD",rightPieName:"FAILCAUSE_AIU_PD_ZH",pieValue:"FAILCOUNT_ID_SUM"},gridConfig:{columns:"",title:"导出表格的文件名",panelTitle:BusinessI18N.cmp.failCause.baseTitle,drillFunc:"",dbDrillFunc:"",tabInfoQueryParam:"",selectColumn:!0,clearFilters:!0},beforeSetGridData:function(e){return e}},this.config=$.extend(this.config,e),this.params=t,this._init(),this},Business.failureReport.prototype.getPanel=function(){return this._panel},Business.failureReport.prototype.requestData=function(e){var t=this;t.config,Sweet.Ajax.request({url:Business.url.getData,async:!1,contentType:"application/json;chartset=UTF-8",data:JSON.stringify(t.params),timeout:3e5,success:function(t){e(t.list)},error:function(){$.error("Business.line() request line's data error!")}})},Business.failureReport.prototype._init=function(){var e=this,t=e.config;e._creatDoublePie(),e._creatGrid();var i={width:"100%",height:"100%",items:[e._piePanel,e._grid.getPanel()],renderTo:t.renderTo||""};e._panel=new Sweet.panel.BorderPanel(i),e._initData()},Business.failureReport.prototype._creatDoublePie=function(){var e=this,t=e.config;e._leftPie=new Sweet.chart.Pie({width:"50%",heigth:"100%",balloonText:t.leftBalloonText,precision:2,switchable:!1,isSortForData:!1,pullOutOnlyOne:!0,title:BusinessI18N.cmp.failCause.leftPieTitle,position:"left",dataKeys:["text","value"],data:[]}),e._rightPie=new Sweet.chart.Pie({width:"50%",heigth:"100%",balloonText:t.rightBalloonText,precision:2,switchable:!1,isSortForData:!1,pullOutOnlyOne:!0,title:BusinessI18N.cmp.failCause.rightPieTitle,position:"right",dataKeys:["text","value"],data:[]}),e._failureInfo=new Sweet.form.Label({align:Sweet.constants.align.RIGHT,symbol:!1,width:"auto",pading:"10px,10px,10px,10px",value:{text:t.panelToolText,value:"",data:null}}),e._piePanel=new Sweet.panel.HPanel({width:"100%",height:400,items:[e._leftPie,e._rightPie],portion:"north",header:!0,title:t.panelTitle,tools:[e._failureInfo],collapsible:!1}),e._leftPieIsOpen=!1,e._leftPie.addListener("click",function(t,i){e._leftPieChange(t.dataItem.pulled,i),e._leftPieIsOpen=t.dataItem.pulled}),e._rightPie.addListener("click",function(t,i){e._rightPieChange(t.dataItem.pulled,i)})},Business.failureReport.prototype._creatGrid=function(){var e=this,t=e.config;e._grid=new Business.grid(t.gridConfig)},Business.failureReport.prototype._initData=function(){var e=this,t=e.config,i=e.config.pieKeys;e.requestData(function(a){if(!$.isNull(a)){var n=e._getPieData({pieId:i.leftPieId,pieName:i.leftPieName,pieValue:i.pieValue},a),o=e._getPieData({pieId:i.rightPieId,pieName:i.rightPieName,pieValue:i.pieValue,fatherKey:i.leftPieId},a,!0);e._leftPie.setData(n),e._rightPie.setData(o),e._rightPie.doLayout(!0),a=t.beforeSetGridData(a),e.allData=$.objClone(a),e._grid.setData({data:a,columns:t.gridConfig.columns})}})},Business.failureReport.prototype._getPieData=function(e,t,i){var a=this;a.config;var n=e.pieId.split(","),o=n.length,r=e.pieName.split(","),s={};t.forEach(function(t){for(var a="",l=0;o>l;l++)a+=t[n[l]],l!==o-1&&(a+=",");var d=i?t[r[0]]+":"+t[r[1]]+"("+t[r[2]]+")":t[r[0]];d=Business.functions.unEscapeHtml(d),s[a]?s[a].value=parseInt(s[a].value)+(parseInt(t[e.pieValue])||0):s[a]={text:d,value:parseInt(t[e.pieValue])||0,filterKey:e.pieId,filterValue:a,fatherKey:e.fatherKey||"",fatherValue:e.fatherKey?t[e.fatherKey]:""}});var l=[];for(var d in s)l.push(s[d]);return l=a._sortPieData(l),i&&(l=a._getTopNData(l)),l},Business.failureReport.prototype._sortPieData=function(e){function t(e,t){var i="value";return e[i]<t[i]?1:e[i]>t[i]?-1:0}var i=this;return i.config,e.sort(t),e},Business.failureReport.prototype._getTopNData=function(e){var t=this,i=t.config,a=i.pieKeys.rightPieId.split(","),n=a.length,o=10;if(e.length>o){for(var r={text:"other",value:0,filterKey:i.pieKeys.rightPieId,filterValue:[],fatherKey:i.pieKeys.leftPieId,fatherValue:[]},s=o;e.length>s;s++){for(var l="",d=0;n>d;d++)l+=e[s][a[d]],d!==n-1&&(l+=",");r.filterValue.push(e[s].filterValue),r.fatherValue.push(e[s].fatherValue),r.value+=e[s].value}e[o]=r,e.length=o+1}return e},Business.failureReport.prototype._leftPieChange=function(e,t){var i=this,a=i.config,n=i.config.pieKeys,o=[],r=[],s=a.pieKeys.leftPieId.split(","),l=s.length;e?i.allData.forEach(function(e){for(var i="",a=0;l>a;a++)i+=e[s[a]],a!==l-1&&(i+=",");t.filterValue===i&&r.push(e)}):r=i.allData,o=i._getPieData({pieId:n.rightPieId,pieName:n.rightPieName,pieValue:n.pieValue,fatherKey:n.leftPieId},r,!0),i._rightPie.setData(o),i._grid.setData({data:r,columns:a.gridConfig.columns})},Business.failureReport.prototype._rightPieChange=function(e,t){var i=this,a=i.config,n=[];if(e){var o=a.pieKeys.rightPieId.split(","),r=o.length;i.allData.forEach(function(e){for(var i="",a=0;r>a;a++)i+=e[o[a]],a!==r-1&&(i+=",");if(t.filterValue===i)n.push(e);else if(Array.isArray(t.filterValue)){var s=t.filterValue.some(function(e){return e===i});s&&n.push(e)}})}else i._leftPieIsOpen?i.allData.forEach(function(e){(t.fatherValue===e[t.fatherKey]||t.fatherValue[0]===e[t.fatherKey])&&n.push(e)}):n=i.allData;i._grid.setData({data:n,columns:a.gridConfig.columns})},Business.failureReport.prototype.destroy=function(){this._panel&&(this._panel.destroy(),this._panel=null)}}(),function(){var e="yyyy-MM-dd hh:mm:ss",t="FORMAT_",i="area_pair";Business.line=function(e){return this.config={graphType:"line",dataKeys:["text"],drillFunc:function(){return null},toggleFunc:function(){return null},portion:"north",chartType:"chart"},this.config=$.extend(this.config,e),this._lineDataKeys=e.dataKeys,this._STARTTIME=e.dataKeys[0].split(",")[0]||"",this._AREATYPE_NAME=e.dataKeys[0].split(",")[1]||"",this._AREATYPE_ID=e.dataKeys[0].split(",")[2]||"",this._lineDataKeys=e.dataKeys,this._lineDataKeys[0]=this._STARTTIME,this._init(),this},Business.line.prototype.getPanel=function(){return this._panel},Business.line.prototype.getValue=function(){var e=this;return e._line.getValue()},Business.line.prototype.requestLineData=function(e,t){var a=this;a.config,a._requestParams=t;var n=e;if(e.areaList&&""+e.areaList===i){var o=$.objClone(a._requestParams);o.isTopN=!1,o.type=i,Sweet.Ajax.request({url:Business.url.getData,async:!1,contentType:"application/json;chartset=UTF-8",data:JSON.stringify(o),timeout:3e5,success:function(e){n={},n={},n.areaList=e.list},error:function(){$.error("Business.line() request line's data error!")}})}a._setObjBoxData(n)},Business.line.prototype.setData=function(e){var t=this;e&&(t._line.setData(e),t._data=e.data)},Business.line.prototype.setTopNObj=function(e){var t=this;t._multiObjBox.setData(e);var i=e.length>=5?e.slice(0,5):e;t._multiObjBox.setValue(i),t._toPNObjValue=e},Business.line.prototype.destroy=function(){this._panel&&(this._panel.destroy(),this._panel=null)},Business.line.prototype._init=function(){var e=this,t=e.config;e._data_multi_sort=null,e._data_his_sort=null,e._data_hisPeriod_sort=null,e._creatMultiObjPanel(),e._creatHisPanel(),e._creatAnalysisTypeRadio();var i={width:"100%",height:350,header:!0,title:BusinessI18N.cmp.line.chartDisplay,toggle:t.toggleFunc,portion:t.portion,items:[e._multiObjHpanel,e._multiLine,e._hisObjHpanel,e._hisLine],padding:0,tools:[e._analysisTypeRadio],itemExtend:!1};e._panel=new Sweet.panel.VPanel(i)},Business.line.prototype._creatMultiObjPanel=function(){var e=this,t=e.config;e._multiObjBox=new Sweet.form.ComboBox_v1({width:BusinessI18N.cmp.line.size.objBoxWidth,multi:!0,maxRemains:5,errorModel:Sweet.constants.tipAttr.MODEL_NORMAL,tip:!0,label:!0,labelText:BusinessI18N.cmp.line.selectObject,labelWidth:BusinessI18N.cmp.line.size.objBoxLabelWidth}),e._multiIndexBox=new Sweet.form.ComboBox_v1({width:BusinessI18N.cmp.line.size.indexWidth,errorModel:Sweet.constants.tipAttr.MODEL_NORMAL,tip:!0,label:!0,labelText:BusinessI18N.cmp.line.indexLabelText,labelWidth:BusinessI18N.cmp.line.size.indexLabelWidth}),e._multiObjHpanel=new Sweet.panel.HPanel({width:"100%",height:25,items:[e._multiObjBox,e._multiIndexBox],itemExtend:!1}),e._multiLine=new Sweet.chart.Line({height:290,width:"100%",graphType:t.graphType,isLegend:!0}),e._multiLine.addListener("click",function(t,i){e._lineDrill(i)})},Business.line.prototype._creatHisPanel=function(){var e=this,t=e.config;e._hisObjBox=new Sweet.form.ComboBox_v1({width:BusinessI18N.cmp.line.size.objBoxWidth,errorModel:Sweet.constants.tipAttr.MODEL_NORMAL,tip:!0,label:!0,labelText:BusinessI18N.cmp.line.selectObject,labelWidth:BusinessI18N.cmp.line.size.objBoxLabelWidth}),e._hisIndexBox=new Sweet.form.ComboBox_v1({width:BusinessI18N.cmp.line.size.indexWidth,errorModel:Sweet.constants.tipAttr.MODEL_NORMAL,tip:!0,label:!0,labelText:BusinessI18N.cmp.line.indexLabelText,labelWidth:BusinessI18N.cmp.line.size.indexLabelWidth}),e._hisPeriodBox=new Sweet.form.ComboBox_v1({width:BusinessI18N.cmp.line.size.periodWidth,errorModel:Sweet.constants.tipAttr.MODEL_NORMAL,tip:!0,label:!0,labelText:BusinessI18N.cmp.line.selectPeriod,labelWidth:BusinessI18N.cmp.line.size.periodLabelWidth}),e._hisObjHpanel=new Sweet.panel.HPanel({width:"100%",height:25,items:[e._hisObjBox,e._hisIndexBox,e._hisPeriodBox],visible:!1,itemExtend:!1}),e._hisLine=new Sweet.chart.Line({height:290,width:"100%",graphType:t.graphType,isLegend:!0,visible:!1}),e._hisLine.addListener("click",function(t,i){e._lineDrill(i)})},Business.line.prototype._creatAnalysisTypeRadio=function(){var e=this;e.config,e._analysisTypeRadio=new Sweet.form.RadioGroup({width:BusinessI18N.cmp.line.size.radioWidth,height:30,columns:"auto",data:[{text:BusinessI18N.cmp.line.multiObject,value:"1",data:null,checked:!0},{text:BusinessI18N.cmp.line.history,value:"2",data:null,checked:!1}]}),e._analysisTypeRadio.addListener("change",function(t,i){if("1"===i.value)e._multiObjHpanel.show(),e._multiLine.show(),e._hisObjHpanel.hide(),e._hisLine.hide();else{if("2"!==i.value)return;e._multiObjHpanel.hide(),e._multiLine.hide(),e._hisObjHpanel.show(),e._hisLine.show(),e._firstClickHisFlag=e._firstClickHisFlag===void 0?!0:!1,e._firstClickHisFlag&&(e._hisObjChange(),e._toPNObjValue&&(e._hisObjBox.setData(e._toPNObjValue),e._toPNObjValue=null))}})},Business.line.prototype._setObjBoxData=function(e){var t=this,i=e.areaList;i=i?i:[],t._multiObjBox.setData(i);var a=i.length>=5?i.slice(0,5):i;t._multiObjBox.setValue(a),t._multiIndexBox.setData(t._getIndexBoxData()),t._hisObjBox.setData(i),t._hisPeriodBox.setData(t._getPerioBoxData()),t._hisIndexBox.setData(t._getIndexBoxData()),i.length>0&&t._multiObjChange(),t._multiObjBox.addListener("change",function(){t._multiObjChange()
}),t._multiIndexBox.addListener("change",function(){t._multiIndexChange()}),t._hisObjBox.addListener("change",function(){t._hisObjChange()}),t._hisIndexBox.addListener("change",function(e,i){t._hisIndexBoxChange(i)}),t._hisPeriodBox.addListener("change",function(e,i){t._hisPeriodBoxChange(i)})},Business.line.prototype._multiObjChange=function(){var e=this;e.config;var t={};t.areaList=Business.functions.getLeafArray($.objClone(e._multiObjBox.getValue())).value,t.areaList&&e._requestData(t,function(t){e._data_multi_sort=e._sortLineData(t),e._multiIndexChange()},!0)},Business.line.prototype._multiIndexChange=function(){var e=this,t=$.objClone(e._multiObjBox.getValue()),i=$.objClone(e._multiIndexBox.getValue()),a=[e._STARTTIME];t.forEach(function(e){a.push([e.value+"_"+i.value,e.text])}),e._multiLine.setData({data:e._data_multi_sort&&e._data_multi_sort.data||[],dataKeys:a,leftUnit:i.data}),e._multiLine.doLayout(!0)},Business.line.prototype._hisObjChange=function(){var e=this;e.config;var t={};t.areaList=$.objClone(e._hisObjBox.getValue()).value,t.areaList&&(e._firstClickHisFlag=e._firstClickHisFlag===void 0?!0:!1,e._requestData(t,function(t){e._data_his_sort=e._sortLineData(t)},!1),e._hisPeriodBoxChange(),e._firstClickHisFlag=!1)},Business.line.prototype._hisPeriodBoxChange=function(){var e=this;e._requestHisPeriodData(),e._hisIndexBoxChange()},Business.line.prototype._requestHisPeriodData=function(){var t=this;t.config;var i=t._hisPeriodBox.getValue().value,a={};if(a.areaList=$.objClone(t._hisObjBox.getValue()).value,a.areaList){var n=$.objClone(t._requestParams.startTime);n=new Date(n.replace(/-/g,"/")),n.setDate(n.getDate()-i),n=$.date.format(n,e);var o=$.objClone(t._requestParams.endTime);o=new Date(o.replace(/-/g,"/")),o.setDate(o.getDate()-i),o=$.date.format(o,e),a.startTime=n,a.endTime=o,t._requestData(a,function(e){t._data_hisPeriod_sort=t._sortLineData(e,t._hisPeriodBox.getValue().value)},!1)}},Business.line.prototype._hisIndexBoxChange=function(){var e=this;e.config;var t=$.objClone(e._hisObjBox.getValue()),i=$.objClone(e._hisIndexBox.getValue()),a=$.objClone(e._hisPeriodBox.getValue()),n=[e._STARTTIME],o=t.value+"_"+i.value;n.push([o,BusinessI18N.cmp.line.currentPeriod]),n.push([o+"_his",a.text]);var r=$.objClone(e._data_his_sort.map);r=$.extend(r,e._data_hisPeriod_sort.map);var s=[];for(var l in r)s.push(l);s=s.sort();var d=[];s.forEach(function(t){var i={};if(i[e._STARTTIME]=t,e._data_his_sort.map[t]>=0){var a=e._data_his_sort.map[t],n=e._data_his_sort.data[a];(n[o]||0==n[o])&&(i[o]=n[o])}if(e._data_hisPeriod_sort.map[t]>=0){var a=e._data_hisPeriod_sort.map[t],n=e._data_hisPeriod_sort.data[a];(n[o]||0==n[o])&&(i[o+"_his"]=n[o])}d.push(i)}),e._hisLine.setData({data:d,dataKeys:n,leftUnit:i.data}),e._hisLine.doLayout(!0)},Business.line.prototype._sortLineData=function(i,a){function n(e,i){var a=0===o._STARTTIME.indexOf(t)?o._STARTTIME.slice(t.length):o._STARTTIME;return e[a]<i[a]?-1:e[a]>i[a]?1:0}var o=this;i=i.list;var r=[],s={},l=o._requestInterval();if(!i||!i.length){if(l&&l.length>0)return l.forEach(function(e,t){var i={};i[o._STARTTIME]=e,r.push(i),s[e]=t}),{data:r,map:s};var d=o._requestParams.startTime,c=o._requestParams.endTime,u={};if(u[o._STARTTIME]=d,r.push(u),s[d]=0,d!==c){var h={};h[o._STARTTIME]=c,r.push(h),s[c]=1}return{data:r,map:s}}i.sort(n);var p=0;i.forEach(function(t){var i={};o._lineDataKeys.forEach(function(e,a){if(a>0){var n=t[o._AREATYPE_ID];i[n+"_"+e[0]]=t[e[0]]}});var n=t[o._STARTTIME];a&&(n=new Date(n.replace(/-/g,"/")),n.setDate(n.getDate()+a),n=$.date.format(n,e),n=n.slice(0,10)+t[o._STARTTIME].slice(10)),r.length>0&&r[r.length-1][o._STARTTIME]===n?r[r.length-1]=$.extend(r[r.length-1],i):(i[o._STARTTIME]=n,r.push(i),s[n]=p,p++)});var f={data:r,map:s};return!l||1>l.length?f:(f={data:[],map:{}},l.forEach(function(e,t){if(s[e]>=0)f.data.push(r[s[e]]);else{var i={};i[o._STARTTIME]=e,f.data.push(i)}f.map[e]=t}),f)},Business.line.prototype._getIndexBoxData=function(){var e=this,t=[];if(e._lineDataKeys){var i=e._lineDataKeys.slice(1);i.forEach(function(e){var i=e[1],a=i.indexOf("("),n=a>=0?i.slice(0,a):i,o=a>=0?i.slice(a+1,i.length-1):"";t.push({value:e[0],text:n,data:o})})}return t},Business.line.prototype._getPerioBoxData=function(){var e=BusinessI18N.cmp.line.timeDate,t=[];return e.forEach(function(e){t.push({value:e[0],text:e[1]})}),t},Business.line.prototype._lineDrill=function(e){var t=this,i=t.config;i.drillFunc(e)},Business.line.prototype._requestData=function(e,t,i){var a=this,n=a.config,o=$.extend($.objClone(a._requestParams),e);o.isTopN=!1,o.type=n.chartType,Sweet.Ajax.request({url:Business.url.getData,async:i,contentType:"application/json;chartset=UTF-8",data:JSON.stringify(o),timeout:3e5,success:function(e){t(e)},error:function(){$.error("Business.line() request line's data error!")}})},Business.line.prototype._requestInterval=function(){var e=this;e.config;var t=[];return Sweet.Ajax.request({url:Business.url.getTimeList,async:!1,contentType:"application/json;chartset=UTF-8",data:JSON.stringify(e._requestParams),timeout:3e5,success:function(e){t=e},error:function(){$.error("Business.line() request timeList's data error!")}}),t}}(),function(){Business.column=function(e){this.config={graphType:"column",graphIntegersOnly:[!1],dataKeys:["text"],objBox:!1,indexBox:!1,drillFunc:function(){return null},toggleFunc:function(){return null},portion:"north",chartType:"chart",labelRotation:0},this.config=$.extend(this.config,e),"column_obj"===this.config.graphType?(this.config.objBox=!0,this.config.indexBox=!1):"column_index"===this.config.graphType?(this.config.objBox=!1,this.config.indexBox=!0):"column_both"===this.config.graphType&&(this.config.objBox=!0,this.config.indexBox=!0),this.config.graphType="column";var t=this.config.graphIntegersOnly;return t instanceof Array||(this.config.graphIntegersOnly="string"==typeof t?"true"===t?[!0]:[!1]:[!1]),this._lineDataKeys=e.dataKeys,this._init(),this},Business.column.prototype.getPanel=function(){return this._panel},Business.column.prototype.getValue=function(){var e=this;return e._line.getValue()},Business.column.prototype.requestLineData=function(e,t){var i=this;i.config,i._requestParams=t,i._setobjBoxData(e)},Business.column.prototype.setData=function(e){var t=this;e&&(t._line.setData(e),t._line.doLayout(!0),t._data=e.data)},Business.column.prototype.setTopNObj=function(e){var t=this;t._objBox.setData(e);var i=e.length>=5?e.slice(0,5):e;t._multiObjBox.setValue(i),t._toPNObjValue=e},Business.column.prototype.destroy=function(){this._panel&&(this._panel.destroy(),this._panel=null)},Business.column.prototype._init=function(){var e=this,t=e.config,i={width:"100%",header:!0,title:BusinessI18N.cmp.line.chartDisplay,toggle:t.toggleFunc,portion:t.portion,datakeys:e._lineDataKeys,height:300,items:e._creatColumnLine()};e._panel=new Sweet.panel.VPanel(i)},Business.column.prototype._creatColumnLine=function(){var e=this,t=e.config,i=[],a=[];return("true"===t.objBox||!0===t.objBox)&&(e._objBox=new Sweet.form.ComboBox_v1({width:BusinessI18N.cmp.line.size.objBoxWidth,multi:!1,maxRemains:5,errorModel:Sweet.constants.tipAttr.MODEL_NORMAL,tip:!0,label:!0,labelText:BusinessI18N.cmp.line.selectObject,labelWidth:BusinessI18N.cmp.line.size.objBoxLabelWidth}),a.push(e._objBox)),("true"===t.indexBox||!0===t.indexBox)&&(e._indexBox=new Sweet.form.ComboBox_v1({name:"interval",width:BusinessI18N.cmp.line.size.indexWidth,height:25,label:!0,labelText:BusinessI18N.cmp.line.indexLabelText,labelWidth:BusinessI18N.cmp.line.size.indexLabelWidth,multi:!1,tip:!0}),a.push(e._indexBox)),a.length>0&&(e._hPanel=new Sweet.panel.HPanel({width:"100%",height:25,items:a,visible:!0,itemExtend:!1}),i.push(e._hPanel)),e._line=new Sweet.chart.Line({height:240,width:"100%",isLegend:!1,isScrollbar:!1,legendTips:!0,definedColor:!1,graphType:t.graphType,labelRotation:t.labelRotation,integersOnly:t.graphIntegersOnly}),e._line.addListener("click",function(t,i){e._lineDrill(i)}),i.push(e._line),i},Business.column.prototype._setobjBoxData=function(e){var t,i=this,a=e.areaList;if(a=a?a:[],i._objBox){i._objBox.setData(a);var n=a.length>=5?a.slice(0,5):a;i._objBox.setValue(n),i._objBox.addListener("change",function(){i._objBoxChange()})}i._indexBox&&(t=i._getIndexBoxData(),i._indexBox.setData(t),!t||1>=t.length?i._indexBox.setDisabled(!0):i._indexBox.setDisabled(!1),i._indexBox.addListener("change",function(){i._indexBoxChange()})),i._objBoxChange()},Business.column.prototype._objBoxChange=function(){var e=this;e.config;var t={};(!e._objBox||(t.areaList=Business.functions.getLeafArray($.objClone(e._objBox.getValue())).value,t.areaList))&&e._requestData(t,function(t){return e._indexBox?(e._indexBoxChange(t),void 0):(e._setColumnData(t),void 0)},!0)},Business.column.prototype._indexBoxChange=function(e){var t=this,i=t._indexBox.getValue(),a=[t._lineDataKeys[0].split(",")[0],[i.value,i.text]];e=e?e:[],t._line.setData({data:e,dataKeys:a,leftUnit:i.data}),t._line.doLayout(!0)},Business.column.prototype._setColumnData=function(e){var t=this;t.config;var i=[t._lineDataKeys[0].split(",")[0],t._lineDataKeys[1]];t._line.setData({data:e,dataKeys:i,leftUnit:t._objBox.getValue().data||""}),t._line.doLayout(!0)},Business.column.prototype._getIndexBoxData=function(){var e=this,t=[];if(e._lineDataKeys){var i=e._lineDataKeys.slice(1);i.forEach(function(e){var i=e[1],a=i.indexOf("("),n=a>=0?i.slice(0,a):i,o=a>=0?i.slice(a+1,i.length-1):"";t.push({value:e[0],text:n,data:o})})}return t},Business.column.prototype._lineDrill=function(e){var t=this,i=t.config;i.drillFunc(e)},Business.column.prototype._requestData=function(e,t,i){var a=this,n=a.config,o=$.extend($.objClone(a._requestParams),e);o.isTopN=!1,o.type=n.chartType,Sweet.Ajax.request({url:Business.url.getData,async:i,contentType:"application/json;chartset=UTF-8",data:JSON.stringify(o),timeout:3e5,success:function(e){t(e.list)},error:function(){$.error("Business.column() request line's data error!")}})}}(),function(){Business.cmpGrid={},Business.cmpGrid={noSupportStr:{plusplus:"--",hundred:"100.00",zero:"0"},drillTpye:{cdr:"cdr",failcause:"failcause",hocause:"hocause"}},Business.grid=function(e){return this.config={columns:[],title:"export",selectColumn:!0,clearFilters:!0,panelTitle:BusinessI18N.cmp.grid.gridDisplay,drillFunc:function(){return null},afterSetDataFunc:function(){return null},dbDrillFunc:function(){return null}},this.config=$.extend(this.config,e),this.gridData=null,this._init(),this},Business.grid.prototype.getCurrentPageData=function(){var e,t=this,i={},a=[],n=0,o=1,r=t.store.getCurrentData();if((!r||0>=r.length)&&(r=t.gridData.data.length>0?t.gridData.data:[]),e=r,t.grid&&(i=t.grid.getPageInfo(),i.currentPage?o=i.currentPage:"",i.size?n=i.size:"",e.length>0?a=e:"",a.length>0)){var s,l;1===o?s=0:o>1&&(s=(o-1)*n),l=n*o,e=a.slice(s,l)}return e},Business.grid.prototype.getPanel=function(){return this.panel},Business.grid.prototype.destroy=function(){this.grid&&(this.grid.destroy(),this.grid=null),this.baseCondition=null,this.gridData=null},Business.grid.prototype.setData=function(e,t){var i=this;if($.isNotNull(e)){if($.isNotNull(t)&&(i.config.queryParam=t),i.gridData=e,e.page={total:e.length},$.isNull(e.columns))$.isNotNull(i.columns)&&(e.columns=i.columns,i.store.loadData(e));else{var a=!1;a=$.equals(i.columns,e.columns),a?i.store.loadData(e):(i.columns=e.columns,i.grid&&(i.grid.destroy(),i.baseCondition=null),i.panel.removeItems(),i._createGrid(e,t),i.panel.addItems(i.grid))}i.baseCondition=i.config.queryParam}},Business.grid.prototype._init=function(){var e=this,t=e.config;e.gridData={data:[],columns:t.columns,page:{total:0}};var i=[];t.columns&&t.columns.length>0&&(e.columns=t.columns,e._createGrid(e.gridData,null),i=[e.grid]),e.toolCounter=new Sweet.form.CheckBox({checked:!1,tip:!0,width:100,height:25,columns:"auto",value:{value:"1",text:BusinessI18N.cmp.grid.counterTool}}),e.panel=new Sweet.panel.VPanel({width:"100%",height:"100%",header:!0,title:t.panelTitle,tools:t.columns.counterHiddened?[e.toolCounter]:[],items:i}),e.toolCounter.addListener("click",function(t,i){e._toolCounterChange(i)})},Business.grid.prototype._toolCounterChange=function(e){var t=this,i=t.config;this.showCounters=e;for(var a=0;i.columns.length>a;a++){var n=i.columns[a];"counter"===n.transform&&(n.hidden=!this.showCounters)}t.grid.headerChanged(i.columns)},Business.grid.prototype._createGrid=function(e){if(!$.isNull(e)){var t=this,i={};i=e,t.store=null,t._dataTotal=0,t.grid&&t.grid.destroy();var a=new Sweet.Reader.JsonReader;i.data&&i.data.length>0?t._dataTotal=i.page&&i.page.total?i.page.total:i.data.length:i.data=[],t.store=new Sweet.Store.GridStore({baseParams:{},reader:a,cache:!0,isRequest:!1});var n=t._createColumnInfo(i.columns);t.config.grid,t.grid=new Sweet.grid.Grid({width:"100%",height:"100%",store:t.store,data:{columns:n,data:[],page:{size:20,total:t._dataTotal},sn:!0,resizable:!0,checkbox:!1,multiColumnSort:t.config.multiColumnSort,selectColumn:t.config.selectColumn,clearFilters:t.config.clearFilters,secondaryStat:!1,"export":!0,exportType:["csv"]}});var o={};i.data&&i.data.length>0&&(o.data=i.data,i.page?o.page=i.page:"",t.store.loadData(o)),t.grid.addListener("cellClick",function(e,i){t.baseDrillData=i}),t.grid.addListener("rowDblClick",function(e,i){t.config.dbDrillFunc&&"function"==typeof t.config.dbDrillFunc&&t.config.dbDrillFunc(e,i)}),t.grid.addListener("afterSetData",function(){t.config.afterSetDataFunc&&"function"==typeof t.config.afterSetDataFunc&&t.config.afterSetDataFunc()}),t.grid.addListener("export",function(e,i){t._onExport(e,i)})}},Business.grid.prototype._renderColumn=function(e){return e&&e.columnDesc&&e.columnDesc.unDrillDatas?$.inArray(""+e.data,e.columnDesc.unDrillDatas)>-1?'<div><span style="color:black;">'+e.data+"</span></div>":'<div><span style="cursor:pointer;text-decoration:underline;">'+e.data+"</span></div>":e.data&&e.data!==Business.cmpGrid.noSupportStr.plusplus&&e.data!==Business.cmpGrid.noSupportStr.hundred&&e.data!==Business.cmpGrid.noSupportStr.zero?'<div><span style="cursor:pointer;text-decoration:underline;">'+e.data+"</span></div>":'<div><span style="color:black;">'+e.data+"</span></div>"},Business.grid.prototype._createColumnInfo=function(e){if(!$.isNull(e)){var t,i={},a=this,n=e;for(a.counterHeaders=[],t=0;n.length>t;t++)if(i=n[t],$.isNotNull(i.menus)&&i.menus.length>0){for(var o=i.menus.length,r=0;o>r;r++)i.menus[r].icon=Business.imagePath.gridCdrDrill;i.itemClick=function(e,t){$.log("itemClick click: "+t),a._onMenuClick(e,t)},i.beforeShowMenu=function(e){if(a.baseDrillData&&a.baseDrillData.rowData){var t=a.baseDrillData.rowData[e.name];if(a.columns&&a.columns.length>0)for(var i=0;a.columns.length>i;i++)if(e.name==a.columns[i].name&&a.columns[i].unDrillDatas)return $.inArray(""+t,a.columns[i].unDrillDatas)>-1?!1:!0;return t&&t!==Business.cmpGrid.noSupportStr.plusplus&&t!==Business.cmpGrid.noSupportStr.hundred&&t!==Business.cmpGrid.noSupportStr.zero?!0:!1}},i.renderer=a._renderColumn}return n}},Business.grid.prototype._onMenuClick=function(e,t){var i=this,a={};a.columnName=i.baseDrillData.name,a.rowData=i.baseDrillData.rowData,a.type=t,i.config.drillFunc&&"function"==typeof i.config.drillFunc&&i.config.drillFunc(a)},Business.grid.prototype._onExport=function(e,t){var i=this,a=i.config,n=[],o={},r=[];o.SN=BusinessI18N.cmp.grid.sn,r.push("SN"),t&&t.columns&&(n=t.columns);for(var s=0;n.length>s;s++)o[n[s].name]=n[s].header,n[s].hidden||r.push(n[s].name);var t=[];i.store&&(t=i.store.getCurrentData()||[]);for(var s=0;t.length>s;s++)t[s].SN=s+1+"";var l={title:a.title,format:"csv",header:o,headerName:r,data:t},d={url:Business.url.exportData,async:!0,loadMask:!0,data:JSON.stringify(l),contentType:"application/json;chartset=UTF-8",timeout:3e5,success:function(e){$.isNull(e.filePath)||"error"===e.filePath?Sweet.Msg.error("Export File Error"):Business.functions.requestDataByForm(Business.url.downLoad,e,"",!1)},error:function(){Sweet.Msg.error("Error")}};Sweet.Ajax.request(d)}}(),function(){Business.report=function(e,t){return this.config={title:"report-title",exportName:"report-title",graphType:"line",columnLabelRotation:0,graphDataKeys:["text"],chartType:"chart",graphDrillFunc:function(){return null},gridColumns:[],gridDrillFunc:function(){return null},gridDbClickDrillFunc:function(){return null}},this._lineObjData=$.objClone(t.areaListObj),delete t.areaListObj,this.params=t,this.config=$.extend(this.config,e),this.config?("line"===this.config.graphType&&(this._AREATYPE_NAME=this.config.graphDataKeys[0].split(",")[1]||"",this._AREATYPE_ID=this.config.graphDataKeys[0].split(",")[2]||""),this._init(),this):void 0},Business.report.prototype.getPanel=function(){return this._panel},Business.report.prototype.requestData=function(){var e=this,t=e.config;e._isLoaded=!0,e._line.requestLineData({areaList:e._lineObjData},$.objClone(e.params)),Sweet.Ajax.request({url:Business.url.getData,contentType:"application/json;chartset=UTF-8",data:JSON.stringify(e.params),timeout:3e5,success:function(i){var a=i.list?i.list:[],n=Business.functions.creatGridFilterList($.objClone(a),$.objClone(t.gridColumns));if(e._grid.setData({data:a,columns:n}),(!t.graphType||"line"===t.graphType)&&e.params.isTopN){var o=[],r={};a.forEach(function(t){r[t[e._AREATYPE_ID]]||(r[t[e._AREATYPE_ID]]=t[e._AREATYPE_NAME],o.push({text:t[e._AREATYPE_NAME],value:t[e._AREATYPE_ID]}))}),e._line.setTopNObj(o)}},error:function(){$.error("Business.report() request grid's data error!")}})},Business.report.prototype.isLoaded=function(){var e=this;return $.isNull(e._isLoaded)?!1:e._isLoaded},Business.report.prototype._init=function(){var e=this,t=e.config;if(e._line=e._creatDiffLine(),!e._line)return $.error("Business.report() has not support the type of chart!"),void 0;var i={columns:t.gridColumns,title:t.exportName,drillFunc:t.gridDrillFunc,dbDrillFunc:t.gridDbClickDrillFunc,multiColumnSort:!t.hideMultiColumnSort,tabInfoQueryParam:t.tabInfoQueryParam};e._grid=new Business.grid(i);var a={title:t.title,width:"100%",height:"100%",items:[e._line.getPanel(),e._grid.getPanel()]};t.renderTo&&(a.renderTo=t.renderTo),e._panel=new Sweet.panel.BorderPanel(a)},Business.report.prototype.destroy=function(){this._panel&&(this._panel.destroy(),this._panel=null)},Business.report.prototype._creatDiffLine=function(){var e=this,t=e.config,i=null,a={graphType:t.graphType,dataKeys:t.graphDataKeys,graphIntegersOnly:t.graphIntegersOnly,drillFunc:t.graphDrillFunc,toggleFunc:function(t){var i=e._line.getPanel().getHeight();t||(i=30),e._panel.setItemSize("north",null,i)}};return"line"===t.graphType?(a.graphType="line",i=new Business.line(a)):-1!=t.graphType.indexOf("column")&&(a.chartType=t.chartType,a.labelRotation=t.columnLabelRotation,i=new Business.column(a)),i}}(),function(){Business.page=function(e,t){var i=this._initPageConfig(e,t);return this.config={module:e,feature:t},this.config=$.extend(this.config,i),this.config?(this._init(),this):void 0},Business.page.prototype.getPanel=function(){return this._panel},Business.page.prototype._initPageConfig=function(e,t){var i={};return Sweet.Ajax.request({url:Business.url.getPageConfig,contentType:"application/json;chartset=UTF-8",async:!1,data:JSON.stringify({module:e,feature:t}),timeout:3e5,success:function(e){$.isNull(e)&&$.error("Business.page() _initPageConfig result is null!"),i=e},error:function(){$.error("Business.page() _initPageConfig error!")}}),i},Business.page.prototype._init=function(){for(var me=this,config=me.config,queryConditionConfig={},conditionCmps=config.queryCondition.cmps.split(","),cmp,i=0;conditionCmps.length>i;i++){var cmp=conditionCmps[i];queryConditionConfig[cmp]=config.queryCondition[cmp]||{}}if(queryConditionConfig.moduleId=config.module+config.feature,queryConditionConfig.queryFunc=function(e){me._queryData(e)},me.config.queryCondition&&me.config.queryCondition.validatorFunc){var validatorFunc=eval(me.config.queryCondition.validatorFunc);"function"==typeof validatorFunc&&(queryConditionConfig.validatorFunc=validatorFunc)}me.queryCondition=new Business.queryCondition(queryConditionConfig),me._queryPanel=me.queryCondition.getPanel(),me._tabPanel=new Sweet.panel.TabPanel({width:"100%",height:"100%",items:[],visible:!1,portion:"center",style:2}),me._mainPanel=new Sweet.panel.BorderPanel({width:"100%",height:"100%",items:[me._queryPanel,me._tabPanel],renderTo:"mainPanel"}),me.queryCondition.getConditionManage().importLastQuery(queryConditionConfig.moduleId),me._tabPanel.addListener("tabchanged",function(){var e=me._tabPanel.getActiveTab();me._reportArr[e].isLoaded()||me._reportArr[e].requestData()})},Business.page.prototype._queryData=function(e){var t=this;t.config,e.sort="",e.isPaging=0,e.currentPage=0,e.pageSize=5e3;var i=t._getTabInfo(e);if(!i||0>=i.length)return $.error("get query params is null!"),void 0;t._tabPanel.removeItems(),t._tabPanel.hide(),t._reportArr=[];for(var a=[],n=0;i.length>n;n++){var o=new Business.report(i[n].reportConfig,i[n].queryParams);t._reportArr.push(o),a.push(o.getPanel())}t._reportArr[0].requestData(),t._tabPanel.addItems(a),t._tabPanel.show(),o.getPanel()&&o.getPanel().doLayout(!0)},Business.page.prototype._getTabInfo=function(queryParams){var me=this,config=this.config;if(config.param.depend&&(config.param.tabs=eval("me.queryCondition._"+config.param.depend+".getTabInfo()")),$.isNull(config.param.tabs)||0===config.param.tabs.length)return $.error("Business.page() -- _getTabInfo -- config.param.tabs is null"),null;for(var tabInfoArr=[],locale=Sweet.getLocale()===Sweet.constants.language.ZH_CN?"zh":"en",i=0;config.param.tabs.length>i;i++){var tabInfo={},tabConfig=config.param.tabs[i];tabInfo.queryParams=$.objClone(queryParams),queryParams.diffTabInfoArr&&(tabInfo.queryParams=$.extend(tabInfo.queryParams,queryParams.diffTabInfoArr[i]),delete tabInfo.queryParams.diffTabInfoArr),tabInfo.queryParams.module=config.module,tabInfo.queryParams.feature=config.feature,tabInfo.queryParams.type=tabConfig.type,tabInfo.queryParams.dbType=config.param.dbType,tabInfo.queryParams.transform=me._getTransformParam(tabConfig.type);var dataKeys=me._getDataKey(tabConfig.graphKey,tabConfig.type,tabInfo.queryParams),tabInfoQueryParam=tabInfo.queryParams;tabInfo.reportConfig={title:tabConfig["text_"+locale],exportName:tabConfig.text_en,graphType:tabConfig.graphType,columnLabelRotation:parseInt(tabConfig.columnLabelRotation)||0,graphIntegersOnly:tabConfig.graphIntegersOnly,graphDataKeys:dataKeys,gridColumns:me._getColumns(tabConfig.type,tabInfo.queryParams,dataKeys[0]),tabInfoQueryParam:tabInfoQueryParam,gridDbClickDrillFunc:tabConfig.gridDbClickDrillFunc,gridDrillFunc:function(e){var t,i=e.type.value,a=$.objClone(this.tabInfoQueryParam);"xdr"!==i&&(t=me._getColumns(i,this.tabInfoQueryParam,dataKeys[0]),a.transform=me._getTransformParam(i));var n=me._getCounters(tabConfig.type,a),o=[];n.forEach(function(e){e.xdrTotal&&"off"===e.xdrTotal&&o.push(e.name)}),delete a.areaListObj,Business.functions.drillFunc(e,a,t,o)}},tabInfoArr.push(tabInfo)}return tabInfoArr},Business.page.prototype._getDataKey=function(e,t,i){var a=this,n=a.config,o=[],r=e.split(","),s=r.some(function(e){return n.dim[e]&&n.dim[e].transform});if(s?o.push("FORMAT_"+e):o.push(e),n.index){var l=Sweet.getLocale()===Sweet.constants.language.ZH_CN?"zh":"en";for(var d in n.index)o.push([d,n.index[d]["text_"+l]]);return o}for(var c=a._getCounters(t,i),u=0;c.length>u;u++)o.push([c[u].name,c[u].text]);return o},Business.page.prototype._getTransformParam=function(e){var t=this.config,i=t.type[e].dims.split(",");if($.isNull(i))return null;for(var a,n,o={},r=0;i.length>r;r++)a=i[r],n=t.dim[a].transform,$.isNull(n)||(o[n]=$.isNull(o[n])?a:o[n]+","+a);for(var s,l=t.type[e].counters,r=0;l.length>r;r++)s=l[r].name,n=l[r].transform||"",$.isNull(n)||(o[n]=$.isNull(o[n])?s:o[n]+","+s);return o},Business.page.prototype._getColumns=function(e,t,i){var a,n=this,o=this.config,r=Sweet.getLocale()===Sweet.constants.language.ZH_CN?"zh":"en",s=[],l=o.type[e].dims.split(","),d="",c="";if(i&&(d=$.objClone(i).split(",")[0],c=$.objClone(i).split(",")[1]),!$.isNull(l))for(var u,h,p,f=0;l.length>f;f++){if(u=l[f],p=o.dim[u].depend,$.isNull(p))h=o.dim[u]["text_"+r];else{if($.isNull(o.dim[u][t[p]]))continue;h=o.dim[u][t[p]]["text_"+r]}var g=$.isNull(o.dim[u].transform)?u:"FORMAT_"+u,m=!1===o.dim[u].sortable||"false"===o.dim[u].sortable?!1:!0,v=!1===o.dim[u].filter||"false"===o.dim[u].filter?!1:!0,_="list";("STARTTIME"===g||"FORMAT_STARTTIME"===g)&&(_="date"),a={name:g,header:h,tooltip:h,height:30,sortable:m,dataType:"string",filter:v,filterType:_,hidden:!1,tip:!0},s.push(a)}var w=n._getCounters(e,t);if(!$.isNull(w))for(var C,b,f=0;w.length>f;f++){if(C=w[f],a={name:C.name,header:C.text,tooltip:C.text,height:30,sortable:C.sortable,dataType:"number",filter:C.filter,filterType:"number",transform:C.transform,hidden:!0===C.hidden||"true"===C.hidden?!0:!1,tip:!0},!s.counterHiddened&&C.hidden&&(s.counterHiddened=C.hidden),$.isNotNull(C.drillType)){a.menus=[],b=C.drillType.split(",");for(var y=0;b.length>y;y++)a.menus.push({value:b[y],text:o.drillType[b[y]]["text_"+r]})}if(C.unDrillDatas){var E=[];if(a.unDrillDatas=JSON.parse(C.unDrillDatas),$.isArray(a.unDrillDatas)&&a.unDrillDatas.length>0){for(var y=0;a.unDrillDatas.length>y;y++)E.push(""+a.unDrillDatas[y]);a.unDrillDatas=E}else delete C.unDrillDatas}s.push(a)}return s},Business.page.prototype._getCounters=function(e,t){var i=this.config,a=i.type[e].counters;if($.isNull(a)||0===a.length)return $.error("Business.page() -- _getCounters -- counterArr is null,type is "+e),null;for(var n,o,r=Sweet.getLocale()===Sweet.constants.language.ZH_CN?"zh":"en",s=[],l=0;a.length>l;l++){if(n=a[l].name,o=i.counter[n].depend,$.isNull(o))a[l].text=i.counter[n]["text_"+r];else{if($.isNull(i.counter[n][t[o]]))continue;a[l].text=i.counter[n][t[o]]["text_"+r]}a[l].sortable=!1===i.counter[a[l].name].sortable||"false"===i.counter[a[l].name].sortable?!1:!0,a[l].filter=!1===i.counter[a[l].name].filter||"false"===i.counter[a[l].name].filter?!1:!0,s.push(a[l])}return s},Business.page.prototype.destroy=function(){}}();var queryModel={},res=BusinessI18N.comm,reader=new Sweet.Reader.JsonReader,store=new Sweet.Store.GridStore({baseParams:{},reader:reader,cache:!0,isRequest:!1});queryModel.deleteRepeatArr=function(e){for(var t={},i=0;e.length>i;i++)t[e[i].text]=e[i];var a=[];for(var n in t)n&&a.push(t[n]);return a},queryModel.addmenu=function(e){for(var t=e.columns,i=0;t.length>i;i++)if("list"==t[i].filterType){var a=[];e.data.forEach(function(e){var n=t[i].name,o={text:e[n],value:e[n]};a.push(o)}),a=queryModel.deleteRepeatArr(a),t[i].filterList=a}},queryModel.text=function(e){var t=queryModel.contents.getRowValue(e);queryModel.confirmBox=new Sweet.Dialog.confirm({width:330,height:130,message:res.confirmDel,listeners:{ok:function(){queryModel.removeCondition(t)}}})},queryModel.operationColumn=function(e){if("1"==e.data){var t=e.row;return"<span class='query-template-delete-icon' onclick=queryModel.text("+t+")></span>"}return"0"==e.data?"<span class='query-template-delete-gray-icon'></span>":void 0};var gridData={columns:[{header:res.templateName,name:"templateName",filter:!0,enableHdMenu:!1,filterType:"list",height:30,tooltip:res.templateName,dataType:"string",tip:!0},{header:res.templateOwner,name:"userName",height:30,filter:!0,enableHdMenu:!1,filterType:"list",dataType:"string",tooltip:res.templateOwner,tip:!0},{header:res.templateType,name:"templateType",height:30,filter:!0,enableHdMenu:!1,filterType:"list",dataType:"string",tooltip:res.templateType,tip:!0},{header:"filter",name:"filter",dataType:"string",hidden:!0,hiddenForever:!0},{header:res.operation,name:"isDelete",height:30,width:res.operationWidth,tooltip:res.operation,renderer:queryModel.operationColumn}],data:[]};queryModel.saveCondition=function(e,t,i,a){var n,o=basePath+"templateManageController/saveQueryTemplate.action",r={businessType:"NPM",moduleId:i.moduleId,filter:a,templateName:e,templateType:t},s=function(e){n=e};return queryModel._request(o,r,s),n},queryModel.removeCondition=function(e){var t=basePath+"templateManageController/deleteQueryTemplate.action",i={businessType:"NPM",moduleId:queryModel.config.moduleId,templateName:e.templateName,templateType:e.template_type,templateOwner:e.userName},a=function(e){if("0"==e.resultCode){var t=queryModel.getCurrentUserServiceQuerys(queryModel.config.moduleId,!1);gridData.data=t,queryModel.addmenu(gridData),store.loadData(gridData),queryModel.okButton.setDisabled(!0)}};queryModel._request(t,i,a)},queryModel.getCurrentUserServiceQuerys=function(e,t){var i=[],a=basePath+"templateManageController/getQueryTemplateList.action",n={businessType:"NPM",isLast:t,moduleId:e},o=function(e){i=e};return queryModel._request(a,n,o),i},queryModel.checkTemplateName=function(e,t){var i=/^[\u0391-\uFFE5\w@#~\-_\(\)\[\] !\.]*$/;return ch=t.text,i.test(ch)?0===ch.length?{success:!1,message:res.templateNameNotNull}:{success:!0,message:""}:{success:!1,message:res.noInput}},queryModel.saveTemplate=function(e,t){queryModel.sweetWnd3&&queryModel.sweetWnd3.destroy();var i="public",a=new Sweet.form.TextField({errorModel:Sweet.constants.tipAttr.MODEL_NORMAL,maxLength:32,width:270,label:!0,labelWidth:105,labelText:res.template_Name,emptyText:res.pleaseInput,validateFun:{eventName:"blur",params:{maxLength:32},fun:queryModel.checkTemplateName}}),n=[{text:res.privates,value:"private",data:null,checked:!1},{text:res.publics,value:"public",data:null,checked:!0}],o=new Sweet.form.RadioGroup({width:"80%",height:30,data:n,tip:!0});o.addListener("click",function(e,t){i=t.value.value});var r=new Sweet.panel.HPanel({width:"100%",height:50,items:[o],itemExtend:!1,align:"center",verticalAlign:"middle",header:!1,collapsible:!1}),s=new Sweet.panel.VPanel({widgetClass:"sweet-panel-vpanel-example",width:"99%",height:180,items:[a,r]}),l=new Sweet.form.Button({value:{text:res.cancel}});l.addListener("click",function(){queryModel.sweetWnd3.close()});var d=new Sweet.form.Button({value:{text:res.save}});d.addListener("click",function(){var n=s.validateForm();if(!n)return!1;var o=a.getValue().value,r=queryModel.saveCondition(o,i,e,t);return"1"==r.resultCode?(Sweet.Msg.error(r.resultDesc),!1):(queryModel.sweetWnd3.close(),Sweet.Msg.success(res.saveTemplateSuccMsg),void 0)}),queryModel.sweetWnd3=new Sweet.Window({width:300,height:150,title:res.saveTemplate,content:s,buttons:[d,l]}),queryModel.sweetWnd3.show()},queryModel.getQueryModel=function(e){queryModel.config=e.config,queryModel.sweetWnd2&&queryModel.sweetWnd2.destroy(),queryModel.contents=new Sweet.grid.Grid({width:"100%",height:"100%",store:store,data:{singleSelect:!0,resizable:!0}}),queryModel.contents.addListener("cellClick",function(e,t){queryModel.baseDrillData=t,queryModel.okButton.setDisabled(!1)}),queryModel.contents.addListener("rowDblClick",function(){e.filterQuery(queryModel.baseDrillData.rowData.filter),queryModel.sweetWnd2.close()});var t=queryModel.getCurrentUserServiceQuerys(queryModel.config.moduleId,!1);gridData.data=t,queryModel.addmenu(gridData),store.loadData(gridData);var i=new Sweet.form.Button({value:{text:res.cancel}});i.addListener("click",function(){queryModel.sweetWnd2.close()}),queryModel.okButton=new Sweet.form.Button({value:{text:res.OK}}),queryModel.okButton.setDisabled(!0),queryModel.okButton.addListener("click",function(){queryModel.baseDrillData?(e.filterQuery(queryModel.baseDrillData.rowData.filter),queryModel.sweetWnd2.close()):Sweet.Msg.warn(res.checkTemplate)}),queryModel.sweetWnd2=new Sweet.Window({width:530,height:300,title:res.importTemplate,content:queryModel.contents,buttons:[queryModel.okButton,i]}),queryModel.sweetWnd2.show()},queryModel.lastQuery=function(e,t){var i=basePath+"templateManageController/saveLastQueryTemplate.action",a={businessType:"NPM",moduleId:e,filter:t},n=function(e){"1"==e.resultCode&&$.log("save last query error！")};queryModel._request(i,a,n)},queryModel._request=function(e,t,i,a){a||(a=!1),Sweet.Ajax.request({url:e,contentType:"application/json;chartset=UTF-8",data:JSON.stringify(t),dataType:"json",async:a,timeout:3e5,success:function(e){$.isFunction(i)&&i(e)
},error:function(t,i,a){$.error(e),$.error("Get data error. XMLHttpRequest = "+t+", error = "+a)}})};